<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>KL Programming Guide</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" title="KL Programming Guide"><div class="titlepage"><div><div><h1 class="title"><a name="d5e1"></a>KL Programming Guide</h1></div><div><p class="releaseinfo">Fabric Engine Version 1.2.0-beta</p></div><div><p class="copyright">Copyright © 2010-2012 Fabric Engine Inc.</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction.hello-world">Hello World in KL</a></span></dt><dt><span class="section"><a href="#introduction.fibonacci">Fibonacci Sequence in KL</a></span></dt><dt><span class="section"><a href="#introduction.mandelbrot">Mandelbrot Set in KL</a></span></dt><dt><span class="section"><a href="#introduction.organization">How This Guide is Organized</a></span></dt></dl></dd><dt><span class="chapter"><a href="#syntax">2. KL Syntax</a></span></dt><dd><dl><dt><span class="section"><a href="#syntax.encoding">Encoding</a></span></dt><dt><span class="section"><a href="#syntax.line-continuations">Line Continuations</a></span></dt><dt><span class="section"><a href="#syntax.comments">Comments</a></span></dt><dd><dl><dt><span class="section"><a href="#syntax.comments.block">Block Comments</a></span></dt><dt><span class="section"><a href="#syntax.comments.line">Line Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#syntax.tokens">Tokens</a></span></dt><dd><dl><dt><span class="section"><a href="#keywords">Keywords</a></span></dt><dt><span class="section"><a href="#syntax.tokens.identifiers">Identifiers</a></span></dt><dt><span class="section"><a href="#syntax.tokens.symbols">Symbols</a></span></dt><dt><span class="section"><a href="#constants">Constants</a></span></dt></dl></dd><dt><span class="section"><a href="#syntax.structure">Program Structure</a></span></dt></dl></dd><dt><span class="chapter"><a href="#types">3. The KL Type System</a></span></dt><dd><dl><dt><span class="section"><a href="#types.base">Base Types</a></span></dt><dd><dl><dt><span class="section"><a href="#types.base.boolean">The <code class="code">Boolean</code> Type</a></span></dt><dt><span class="section"><a href="#integers">Integer Types</a></span></dt><dt><span class="section"><a href="#types.base.floating-point">Floating-Point Types</a></span></dt><dt><span class="section"><a href="#string-type">The <code class="code">String</code> Type</a></span></dt></dl></dd><dt><span class="section"><a href="#types.derived">Derived Types</a></span></dt><dd><dl><dt><span class="section"><a href="#structs">Structures</a></span></dt><dt><span class="section"><a href="#arrays">Arrays</a></span></dt><dt><span class="section"><a href="#dicts">Dictionaries</a></span></dt><dt><span class="section"><a href="#map-reduce-types">Map-Reduce Types</a></span></dt></dl></dd><dt><span class="section"><a href="#types.aliases">Type Aliases</a></span></dt><dt><span class="section"><a href="#types.data">The <code class="code">Data</code> Type and the <code class="code">data</code> and <code class="code">dataSize</code> Methods</a></span></dt></dl></dd><dt><span class="chapter"><a href="#globals">4. Functions and Other Global Declarations</a></span></dt><dd><dl><dt><span class="section"><a href="#functions">Function Definitions</a></span></dt><dt><span class="section"><a href="#function-calls">Function Invocations</a></span></dt><dt><span class="section"><a href="#prototypes">Function Prototypes</a></span></dt><dt><span class="section"><a href="#built-in-functions">Built-in Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#built-in-functions.report">The <code class="code">report</code> Function</a></span></dt><dt><span class="section"><a href="#built-in-functions.numerical">Numerical Functions</a></span></dt></dl></dd><dt><span class="section"><a href="#polymorphism">Function Polymorphism</a></span></dt><dt><span class="section"><a href="#operators">Operators</a></span></dt><dt><span class="section"><a href="#constructors">Constructors</a></span></dt><dd><dl><dt><span class="section"><a href="#constructors.declaration">Constructor Declarations</a></span></dt><dt><span class="section"><a href="#constructors.invocation">Constructor Invocation</a></span></dt></dl></dd><dt><span class="section"><a href="#destructors">Destructors</a></span></dt><dt><span class="section"><a href="#methods">Methods</a></span></dt><dd><dl><dt><span class="section"><a href="#method-defs">Method Definitions</a></span></dt><dt><span class="section"><a href="#method-calls">Method Invocation</a></span></dt><dt><span class="section"><a href="#d5e1497">Methods Taking Read-Only or Read-Write Values for <code class="code">this</code></a></span></dt></dl></dd><dt><span class="section"><a href="#op-overloads">Overloaded Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#op-overloads.binop">Binary Operator Overloads</a></span></dt><dt><span class="section"><a href="#overloading-compound-ass-ops">Compound Assignment Overloads</a></span></dt></dl></dd><dt><span class="section"><a href="#global-constants">Global Constants</a></span></dt><dt><span class="section"><a href="#use">Importing Functionality With <code class="code">require</code></a></span></dt></dl></dd><dt><span class="chapter"><a href="#ops-exprs">5. Operators and Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#ops">Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#arithmetic-ops">Arithmetic Operators</a></span></dt><dt><span class="section"><a href="#logical-ops">Logical Operators</a></span></dt><dt><span class="section"><a href="#bitwise-ops">Bitwise Operators</a></span></dt><dt><span class="section"><a href="#ass-ops">Assignment Operators</a></span></dt><dt><span class="section"><a href="#ops-and-polymorphism">Operators and Polymorphism</a></span></dt></dl></dd><dt><span class="section"><a href="#exprs">Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#simple-exprs">Simple Expressions</a></span></dt><dt><span class="section"><a href="#compound-exprs">Compound Expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#order-of-ops">Controlling Order of Operations</a></span></dt><dt><span class="section"><a href="#scope">Scoping Rules</a></span></dt><dd><dl><dt><span class="section"><a href="#scope.types">Types of Scopes</a></span></dt><dt><span class="section"><a href="#scope.example">Nested Scopes Example</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#statements">6. Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#simple-statements">Simple Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#expr-statements">Expression Statements</a></span></dt><dt><span class="section"><a href="#throw-statement">The <code class="code">throw</code> Statement</a></span></dt><dt><span class="section"><a href="#empty-statement">The Empty Statement</a></span></dt><dt><span class="section"><a href="#var-decl-statements">Variable Declaration Statements</a></span></dt></dl></dd><dt><span class="section"><a href="#complex-statements">Complex Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#compound-statements">Compound Statements</a></span></dt><dt><span class="section"><a href="#cond-statements">Conditional Statements</a></span></dt><dt><span class="section"><a href="#return-statement">The <code class="code">return</code> Statement</a></span></dt><dt><span class="section"><a href="#loop-statements">Loop Statements</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#map-reduce">7. Map-Reduce</a></span></dt><dd><dl><dt><span class="section"><a href="#mr-types">Map-Reduce Types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-producer">The <code class="code">ValueProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</a></span></dt><dt><span class="section"><a href="#array-producer">The <code class="code">ArrayProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</a></span></dt></dl></dd><dt><span class="section"><a href="#mr-functions">Map-Reduce Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e2534">Value Producer Creation Functions</a></span></dt><dt><span class="section"><a href="#d5e2677">Array Producer Creation Functions</a></span></dt><dt><span class="section"><a href="#d5e2841">Reduce Creation Functions</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>5.1. <a href="#d5e1842">Compound expressions</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>1.1. <a href="#introduction.hello-world.ex">Hello world</a></dt><dt>1.2. <a href="#introuction.fibonacci.ex">Fibonacci sequence generator</a></dt><dt>1.3. <a href="#introuction.mandelbrot.ex">Mandelbrot set generator</a></dt><dt>2.1. <a href="#syntax.line-continuations.ex">Line continuations</a></dt><dt>2.2. <a href="#syntax.comments.block.good.ex">Acceptable block comments</a></dt><dt>2.3. <a href="#syntax.comments.block.bad.ex">Erroneous block comments</a></dt><dt>2.4. <a href="#syntax.comments.line.ex">Line comments</a></dt><dt>2.5. <a href="#syntax.tokens.constants.boolean.ex">Boolean constants</a></dt><dt>2.6. <a href="#syntax.tokens.constants.integer.ex">Integer constants</a></dt><dt>2.7. <a href="#d5e516">Floating-point constants</a></dt><dt>2.8. <a href="#syntax.tokens.constants.string.ex">String constants</a></dt><dt>3.1. <a href="#types.base.boolean.ex">The <code class="code">Boolean</code> type</a></dt><dt>3.2. <a href="#types.base.integers.ex">Integer types</a></dt><dt>3.3. <a href="#types.base.floating-points.ex">Floating-point types</a></dt><dt>3.4. <a href="#types.base.string.ex">String type</a></dt><dt>3.5. <a href="#types.derived.struct.use.ex">Structure use</a></dt><dt>3.6. <a href="#types.derived.arrays.variable.ex">Variable-size arrays</a></dt><dt>3.7. <a href="#types.derived.arrays.fixed.ex">Fixed-size arrays</a></dt><dt>3.8. <a href="#types.derived.arrays.sliced.ex">Sliced arrays</a></dt><dt>3.9. <a href="#types.derived.dicts.ex">Dictionaries</a></dt><dt>3.10. <a href="#types.aliases.ex">Type aliases</a></dt><dt>3.11. <a href="#types.data.ex"><code class="code">Data</code> values and the <code class="code">data</code> and <code class="code">dataSize</code> methods</a></dt><dt>4.1. <a href="#functions.ex">Function definitions</a></dt><dt>4.2. <a href="#functions.call.ex">Function call</a></dt><dt>4.3. <a href="#prototypes.ex">Co-recursion using a prototype</a></dt><dt>4.4. <a href="#prototypes.external.ex">External function</a></dt><dt>4.5. <a href="#polymorphism.ex">Function polymorphism</a></dt><dt>4.6. <a href="#operators.ex">Operator definition</a></dt><dt>4.7. <a href="#constructors.declaration.ex">Constructor declarations</a></dt><dt>4.8. <a href="#constructors.invocation.naked.ex">Constructor invocation using naked initialization</a></dt><dt>4.9. <a href="#constructors.invocation.assignment.ex">Constructor invocation using assignment initialization</a></dt><dt>4.10. <a href="#constructors.invocation.call.ex">Constructor invocation using invocation initialization</a></dt><dt>4.11. <a href="#constructors.invocation.temp.ex">Constructor invocation using temporary value</a></dt><dt>4.12. <a href="#destructors.ex">Destructor</a></dt><dt>4.13. <a href="#methods.ex">Method definition and invocation</a></dt><dt>4.14. <a href="#d5e1507">Explicit read-only or read-write <code class="code">this</code> in methods</a></dt><dt>4.15. <a href="#op-overloads.binop.ex">Binary operator overload</a></dt><dt>4.16. <a href="#op-overloads.assop.ex">Compound assignment overload</a></dt><dt>4.17. <a href="#global-constants.ex">Global constants</a></dt><dt>5.1. <a href="#d5e2134">Controlling Order of Operations</a></dt><dt>5.2. <a href="#scope.ex">Nested scopes</a></dt><dt>6.1. <a href="#d5e2196">Expression statements</a></dt><dt>6.2. <a href="#d5e2206">The <code class="code">throw</code> statement</a></dt><dt>6.3. <a href="#d5e2217">The empty statement</a></dt><dt>6.4. <a href="#d5e2230">Variable declaration statements</a></dt><dt>6.5. <a href="#d5e2263">The <code class="code">if</code> statement</a></dt><dt>6.6. <a href="#d5e2275">The <code class="code">switch</code> statement</a></dt><dt>6.7. <a href="#d5e2291">The <code class="code">return</code> statement</a></dt><dt>6.8. <a href="#d5e2341"><span class="quote">“<span class="quote">C-Style</span>”</span> loop</a></dt><dt>6.9. <a href="#d5e2371"><code class="code">while</code> loop</a></dt><dt>6.10. <a href="#d5e2402"><code class="code">do</code>...<code class="code">while</code> loop</a></dt><dt>6.11. <a href="#d5e2422">The <code class="code">break</code> statement</a></dt><dt>6.12. <a href="#d5e2432">The <code class="code">continue</code> statement</a></dt><dt>7.1. <a href="#d5e2545"><code class="code">createConstValue</code></a></dt><dt>7.2. <a href="#d5e2579"><code class="code">createValueGenerator</code></a></dt><dt>7.3. <a href="#d5e2614"><code class="code">createValueTransform</code></a></dt><dt>7.4. <a href="#d5e2653"><code class="code">createValueMap</code></a></dt><dt>7.5. <a href="#d5e2670"><code class="code">createValueCache</code></a></dt><dt>7.6. <a href="#d5e2691"><code class="code">createConstArray</code></a></dt><dt>7.7. <a href="#d5e2730"><code class="code">createArrayGenerator</code></a></dt><dt>7.8. <a href="#d5e2770"><code class="code">createArrayTransform</code></a></dt><dt>7.9. <a href="#d5e2817"><code class="code">createArrayMap</code></a></dt><dt>7.10. <a href="#d5e2834"><code class="code">createArrayCache</code></a></dt><dt>7.11. <a href="#d5e2881"><code class="code">createReduce</code></a></dt></dl></div><div class="chapter" title="Chapter&nbsp;1.&nbsp;Introduction"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#introduction.hello-world">Hello World in KL</a></span></dt><dt><span class="section"><a href="#introduction.fibonacci">Fibonacci Sequence in KL</a></span></dt><dt><span class="section"><a href="#introduction.mandelbrot">Mandelbrot Set in KL</a></span></dt><dt><span class="section"><a href="#introduction.organization">How This Guide is Organized</a></span></dt></dl></div><p>
      KL (pronounced <span class="emphasis"><em>kale</em></span>) is the programming language used for Fabric operators.  KL stands for <span class="quote">“<span class="quote">kernel language</span>”</span>; in this context, <span class="emphasis"><em>kernel</em></span> refers to the concept of a computational kernel as used in multithreaded programming.
    </p><p>
      KL was designed with the following goals:

      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          KL is designed to run <em class="glossterm">performance-critical</em> sections of <em class="glossterm">dynamic-language</em> programs.  As such, KL is designed so that KL programs run as quickly as possible on modern hardware.
        </p></li><li class="listitem"><p>
          KL should be easy to learn for someone who is already familiar with programming in JavaScript and other scripting languages.
        </p></li><li class="listitem"><p>
          It must be possible to compile most KL programs to run on different architectures and kinds of hardware, specifically <acronym class="acronym">CPU</acronym>s and <acronym class="acronym">GPU</acronym>s.
        </p></li></ul></div><p>

      As such, KL is a language with a syntax very similar to JavaScript but that is <span class="emphasis"><em>procedural</em></span>, <span class="emphasis"><em>strongly-typed</em></span> and with <span class="emphasis"><em>low-level data layouts</em></span>.  Being <span class="emphasis"><em>procedural</em></span> means that, unlike JavaScript, functions (or, rather, closures) are not first-class objects that can be passed around in the language; instead, functions are always globally declared.  Being <span class="emphasis"><em>strongly-typed</em></span> means that, in a KL program, the types of all variables and function parameters are known at compile type, unlike JavaScript where types are only known at runtime.  Having <span class="emphasis"><em>low-level data layouts</em></span> means that the size of data and the way that it is laid out in memory is guaranteed and controllable by the programmer.
    </p><p>
      Before diving in to the details of the language, we will present some simple examples.  We don't expect you to understand all the details of the examples, but hopefully they will give you a basic idea of what KL programs look like as well as some of what is possible with KL.  All of these examples can be run by downloading and installing the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="filename"><code class="filename">FabricEngine-KLTool-...</code></span> file that is appropriate for your operating system from <a class="link" href="http://dist.fabric-engine.com/latest/" target="_top"><code class="uri">http://dist.fabric-engine.com/latest/</code></a>.  Once installed, you can copy the source code to a text file and run <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl <em class="replaceable"><code>filename.kl</code></em></code></span>.
    </p><div class="section" title="Hello World in KL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction.hello-world"></a>Hello World in KL</h2></div></div></div><p>
        Traditionally, the first program you see in a language is one that says hello.  In KL, the "Hello, world!" program is simple:
        
        </p><div class="example"><a name="introduction.hello-world.ex"></a><p class="title"><b>Example&nbsp;1.1.&nbsp;Hello world</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report("Hello, world!");
}
          </pre></div></div><p><br class="example-break">
        
        Running this program through the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool, the output is:
      
        </p><div class="informalfigure"><a name="introduction.hello-world.ex.out"></a><pre class="screen">
Hello, world!
          </pre></div><p>
        
        There's not much to learn from this program, but it does introduce a few concepts:
        
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="code">entry</code> operator is what is run by the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool.  KL distinguishes places in the program that can be called from the outside world—in this case, the outside world is the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool itself.  We discuss more about operators in <a class="xref" href="#operators" title="Operators">the section called “Operators”</a></p></li><li class="listitem"><p>The <code class="code">report</code> function sends some text to wherever messages go.  In the case of the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool, messages go to standard output; when running within a web browser, messages appear on the JavaScript console; for console applications (in Node.js or Python for example), messages go to standard error.</p></li><li class="listitem"><p>The text <code class="code">"Hello, world!"</code> is a <em class="glossterm">string constant</em>.  String constants in KL follow almost exactly the same syntax as JavaScript.</p></li></ul></div><p>
      </p></div><div class="section" title="Fibonacci Sequence in KL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction.fibonacci"></a>Fibonacci Sequence in KL</h2></div></div></div><p>
        Next, we present a somewhat more sophisticated example that computes the first few terms of the Fibonacci sequence.  The Fibonacci sequence is the number sequence whose first few terms are 1 and 1, and whose further terms are the sum of the previous two in the sequence, ie. 2, 3, 5, 8, and so on.  There are several ways of computing the Fibonacci sequence in a programming language but we choose the naive, recursive way in order to illustrate some more language features of KL.

        </p><div class="example"><a name="introuction.fibonacci.ex"></a><p class="title"><b>Example&nbsp;1.2.&nbsp;Fibonacci sequence generator</b></p><div class="example-contents"><pre class="programlisting">
/* Recursively compute the Fibonacci sequence.
** The first term is returned with n = 0
*/
function Integer fibonacci(Integer n) {
  if (n &lt;= 1)
    return 1; // The first two terms (n=0 or n=1) are 1
  else 
    return fibonacci(n - 2) + fibonacci(n - 1);
}

operator entry() {
  for (Integer i = 0; i &lt; 10; ++i)
    report(fibonacci(i));
}
          </pre></div></div><p><br class="example-break">
        
        Running this program through the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool, the output is:
      
        </p><div class="informalfigure"><a name="introuction.fibonacci.out"></a><pre class="screen">
1
1
2
3
5
8
13
21
34
55
          </pre></div><p>
      
        The Fibonacci example highlights a few simple features of KL, including:

        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Function and parameter declaration</p></li><li class="listitem"><p>Recursion</p></li><li class="listitem"><p>Conditional statements</p></li><li class="listitem"><p>Loops</p></li><li class="listitem"><p>Comments</p></li></ul></div><p>
      </p></div><div class="section" title="Mandelbrot Set in KL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction.mandelbrot"></a>Mandelbrot Set in KL</h2></div></div></div><p>
        Finally, we present an example of a KL program that generates the Mandelbrot set and outputs it visually as ASCII art.  The Mandelbrot set is a mathematical set defined by complex recursive functions, but that it best known because the patterns it contains are visually stunning.  Refer to the Wikipedia entry on the Mandelbrot set at <a class="link" href="http://en.wikipedia.org/wiki/Mandelbrot_set" target="_top"><code class="uri">http://en.wikipedia.org/wiki/Mandelbrot_set</code></a> for more information.
      </p><p>
        KL includes very powerful features for extending the language for computational problems such as that of computing the values of the Mandelbrot set, as seen in the source code below:
        
        </p><div class="example"><a name="introuction.mandelbrot.ex"></a><p class="title"><b>Example&nbsp;1.3.&nbsp;Mandelbrot set generator</b></p><div class="example-contents"><pre class="programlisting">
struct Complex32 {
  Float32 re;
  Float32 im;
};

function Complex32(Float32 re, Float32 im) {
  this.re = re;
  this.im = im;
}

function Complex32 +(Complex32 lhs, Complex32 rhs) {
  return Complex32(lhs.re + rhs.re, lhs.im + rhs.im);
}

function Complex32 *(Complex32 lhs, Complex32 rhs) {
  return Complex32(lhs.re*rhs.re-lhs.im*rhs.im, lhs.re*rhs.im + lhs.im*rhs.re);
}

function Float32 Complex32.normSq() {
  return this.re*this.re + this.im*this.im;
}

function Byte computeDwell(Complex32 c) {
  Complex32 z = c;
  Size count;
  for (count = 0; count &lt; 255; ++count) {
    if (z.normSq &gt; 4)
      break;
    z = z*z + c;
  }
  return count;
}

operator entry()
{
  Complex32 z;
  for (Size row=9; row&lt;=31; ++row) {
    z.im = 4.0 * row / 40.0 - 2.0;
    String rowString;
    for (Size col=0; col&lt;=78; ++col) {
      z.re = 4.0 * col / 78.0 - 2.0;
      Byte dwell = computeDwell(z);
      
      if (dwell &amp; 192)
        rowString += "#";
      else if (dwell &amp; 48)
        rowString += "*";
      else if (dwell &amp; 12)
        rowString += ".";
      else
        rowString += " ";
    }
    report(rowString);
  }
}
          </pre></div></div><p><br class="example-break">
        
        Running this program through the <span xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xslthl="http://xslthl.sf.net" xmlns:d="http://docbook.org/ns/docbook" class="command"><code class="command">kl</code></span> tool, the output is:
      
        </p><div class="informalfigure"><a name="fig.mandelbrot.out"></a><pre class="screen">
                                  .....                                        
                                .......#.                                      
                              ......**.....                                    
                            .......####*.....                                  
                         ..........####.........                               
                    ........*#**##########*...*..                              
               .............*#################....                             
            ...............###################....                             
          ......*..*.*...*#####################...                             
        ........*######*.######################*..                             
      ......*..################################...                             
############################################*.....                             
      ......*..################################...                             
        ........*######*.######################*..                             
          ......*..*.*...*#####################...                             
            ...............###################....                             
               .............*#################....                             
                    ........*#**##########*...*..                              
                         ..........####.........                               
                            .......####*.....                                  
                              ......**.....                                    
                                .......#.                                      
                                  .....                                        
          </pre></div><p>
      
        The Mandelbrot set example highlights a few of the more sophisticated features of KL, including:

        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>User-defined types</p></li><li class="listitem"><p>Constructors</p></li><li class="listitem"><p>Operator overloads</p></li><li class="listitem"><p>Methods</p></li><li class="listitem"><p>Bitwise operators</p></li><li class="listitem"><p>Variable-length arrays</p></li></ul></div><p>
      </p></div><div class="section" title="How This Guide is Organized"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction.organization"></a>How This Guide is Organized</h2></div></div></div><p>
        Unlike other languages, KL is a language designed to add performance-critical sections to programs written in dynamic languages.  As such, this guide assumes that you are already familiar with the basic concepts of modern programming languages, including types, expressions, statements (eg. conditional statements, loop statements, return statements) and functions.
      </p><p>
        Since it's difficult to provide meaningful examples in a computer language without using many concepts of the language, we will often use or even refer to concepts that aren't discussed until later in the guide.  We leave it up to you to decide whether to jump ahead or to just keep reading and see where things go.
      </p><p>
        The remainder of the guide is laid out as follows:
        
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            <a class="xref" href="#syntax" title="Chapter&nbsp;2.&nbsp;KL Syntax">Chapter&nbsp;2, <i>KL Syntax</i></a> describes the syntax of KL.  KL has a syntax very similar to JavaScript (like JavaScript, it is a <span class="quote">“<span class="quote">C-like</span>”</span> language) so this syntax will be familiar to many programmers.  If you are already familiar with the syntax of JavaScript or C, we recommend that you skip this chapter and move on to the next; you can always come back to it later for reference.
          </p></li><li class="listitem"><p>
            <a class="xref" href="#types" title="Chapter&nbsp;3.&nbsp;The KL Type System">Chapter&nbsp;3, <i>The KL Type System</i></a> introduces the type system of KL.  KL comes with a rich set of base types that includes integers, floating-point numbers, strings and booleans, as well as derived types including structures, arrays and dictionaries.
          </p></li><li class="listitem"><p>
            <a class="xref" href="#globals" title="Chapter&nbsp;4.&nbsp;Functions and Other Global Declarations">Chapter&nbsp;4, <i>Functions and Other Global Declarations</i></a> describes how functions and other global declarations are made in KL.  KL includes support for basic functions (also referred to as procedures in other languages), but also support more complex function concepts such as prototypes, methods and overloaded operators.  It also supports global constants, as well as a facility to import functionality from external modules.
          </p></li><li class="listitem"><p>
            <a class="xref" href="#ops-exprs" title="Chapter&nbsp;5.&nbsp;Operators and Expressions">Chapter&nbsp;5, <i>Operators and Expressions</i></a> describes the set of operators supported by KL and the different kinds of expressions that can be formed using these operators.  It also discusses the rules that govern scoping for variables and other symbols.
          </p></li><li class="listitem"><p>
            <a class="xref" href="#statements" title="Chapter&nbsp;6.&nbsp;Statements">Chapter&nbsp;6, <i>Statements</i></a> describes the different statements that are available for function bodies in KL.
          </p></li></ul></div><p>
      </p></div></div><div class="chapter" title="Chapter&nbsp;2.&nbsp;KL Syntax"><div class="titlepage"><div><div><h2 class="title"><a name="syntax"></a>Chapter&nbsp;2.&nbsp;KL Syntax</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#syntax.encoding">Encoding</a></span></dt><dt><span class="section"><a href="#syntax.line-continuations">Line Continuations</a></span></dt><dt><span class="section"><a href="#syntax.comments">Comments</a></span></dt><dd><dl><dt><span class="section"><a href="#syntax.comments.block">Block Comments</a></span></dt><dt><span class="section"><a href="#syntax.comments.line">Line Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#syntax.tokens">Tokens</a></span></dt><dd><dl><dt><span class="section"><a href="#keywords">Keywords</a></span></dt><dt><span class="section"><a href="#syntax.tokens.identifiers">Identifiers</a></span></dt><dt><span class="section"><a href="#syntax.tokens.symbols">Symbols</a></span></dt><dt><span class="section"><a href="#constants">Constants</a></span></dt></dl></dd><dt><span class="section"><a href="#syntax.structure">Program Structure</a></span></dt></dl></div><p>
      When KL was developed it was designed to have a syntax as close as possible to JavaScript, which itself is what is referred to as a <span class="quote">“<span class="quote">C-like language</span>”</span> (as far as syntax is concerned).  This chapter goes into the details of KL syntax, and can act as a reference for you if you are not familiar with C-like languages.  On the other hand, if you are already familiar with the syntax of JavaScript and/or C, we recommend that you skip this chapter and move on to the next.
    </p><p>
      Some of the key characteristics of C-like languages are:
      
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          Programs are plain, human-readable text files.
        </p></li><li class="listitem"><p>
          A program is a sequence of <em class="glossterm">tokens</em>.  There are four major types of tokens: keywords, identifiers, symbols and constants.
        </p></li><li class="listitem"><p>
          Tokens may be separated by arbitrary whitespace and <span class="emphasis"><em>must</em></span> be separated by whitespace in the case that it would make two adjacent tokens appear to be a single, different token.  By whitespace, we mean spaces (ASCII 32), newlines (ASCII 10), tabs (ASCII 9), carriage returns (ASCII 13) and vertical tabs (ASCII 11).
        </p></li><li class="listitem"><p>
          Programs can contain comments anywhere and comments are treated like whitespace when the program is processed by the computer.  There are two types of comments: block comments, which begin with <code class="code">/*</code> and end with <code class="code">*/</code>, and line comments, which begin with <code class="code">//</code> and continue to the next newline (ASCII 10).
        </p></li><li class="listitem"><p>
          Blocks are delimited by <code class="code">{</code> and <code class="code">}</code>
        </p></li><li class="listitem"><p>
          Statements are terminated with <code class="code">;</code>
        </p></li></ul></div><p>
      
      We delve into some more details of the KL syntax below.
    </p><div class="section" title="Encoding"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="syntax.encoding"></a>Encoding</h2></div></div></div><p>
        Although KL programs are plain, human-readable text files, KL does specify an encoding for the text files: UTF-8.  The KL compiler assumes that all KL source code is encoded as UTF-8 without any encoding marks.  KL programs which contain invalid UTF-8 sequences cannot be compiled and will result in syntax errors.
      </p><p>
        If you don't understand exactly what this means, don't worry: plain 7-bit ASCII text files, such as used for C source code (and often for JavaScript source code) are by default UTF-8 encoded.  The only thing to keep in mind is that text files saved on Windows in <span class="quote">“<span class="quote">Unicode format</span>”</span> (which technically means they are encoded as UCS-2) cannot be read by the KL compiler.  If you want to insert foreign language characters into a KL source file you must use an editor that can write UTF-8 files.
      </p><p>
        The benefit of specifying an encoding is that high-bit characters, such as foreign language characters, can be inserted directly into string constants in KL source files.
      </p></div><div class="section" title="Line Continuations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="syntax.line-continuations"></a>Line Continuations</h2></div></div></div><p>
        Like C, any line of a KL program that ends with a <code class="code">\</code> (backslash) character causes the line to be joined with the next line.  This is useful for breaking long lines into multiple lines when a single token needs to be split; usually this token would be a long string.
      </p><div class="example"><a name="syntax.line-continuations.ex"></a><p class="title"><b>Example&nbsp;2.1.&nbsp;Line continuations</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report("\
This is a really, really long string \
that spans multiple lines.  Note that \
     &lt;-- the SPACES at the beginning \
of the next line are preserved!");
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="syntax.line-continuations.out"></a><p>Output:</p><pre class="screen">
This is a really, really long string that spans multiple lines.  Note that      &lt;-- the SPACES at the beginning of the next line are preserved!
        </pre></div></div><div class="section" title="Comments"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="syntax.comments"></a>Comments</h2></div></div></div><p>
        As mentioned previously, KL supports the same two types of comments as C and JavaScript: block comments and line comments.
      </p><div class="section" title="Block Comments"><div class="titlepage"><div><div><h3 class="title"><a name="syntax.comments.block"></a>Block Comments</h3></div></div></div><p>
          A block comment in KL is an arbitrary sequence of characters that begins with the characters <code class="code">/*</code> and ends with the characters <code class="code">*/</code>.  Like C, KL ends a block comment as soon as it encounters the first sequence <code class="code">*/</code>.  Also like C, KL does not recognize nested comments.  The following examples illustrate acceptable and erroneous bad block comments in KL.
        </p><div class="example"><a name="syntax.comments.block.good.ex"></a><p class="title"><b>Example&nbsp;2.2.&nbsp;Acceptable block comments</b></p><div class="example-contents"><pre class="programlisting">
/* A simple, one-line block comment */

/* This is
   a multi-line
   block comment
   */
   
/*
** And so is this
*/

operator entry() {
  /* comments can appear in source code */
  report("Hello!"); /* pretty much anywhere */
  foo( 32 /*, 53*/ ); /* block comments are a simple way to temporarily remove code */
}
          </pre></div></div><br class="example-break"><div class="example"><a name="syntax.comments.block.bad.ex"></a><p class="title"><b>Example&nbsp;2.3.&nbsp;Erroneous block comments</b></p><div class="example-contents"><pre class="programlisting">
/* KL ends the comment
 * as soon as the first */
 * is seen, so this is
 * a bad block comment that 
 * results in a syntax error
 */

/* Like C, block comments
 * cannot nest in KL,
   /* so this is also
    * a bad comment that
    * will result in a
    * syntax error
    */
 */
          </pre></div></div><br class="example-break"><p>
          Be careful with block comments; if either of the errors of the type given above occur in your program it can be very difficult to figure out what has gone wrong; the syntax errors you are given will seem to have nothing to do with your program.  For this reason, we recommend that you use line comments, which are described next.
        </p></div><div class="section" title="Line Comments"><div class="titlepage"><div><div><h3 class="title"><a name="syntax.comments.line"></a>Line Comments</h3></div></div></div><p>
          A line comment in KL begins with the character sequence <code class="code">//</code> and continues until the end of the line (ASCII character 10).  Unlike block comments, there are no <span class="quote">“<span class="quote">gotchas</span>”</span> with line comments: they work exactly as expected.  However, they can't be used to comment out sections of code in the middle of a line
        </p><div class="example"><a name="syntax.comments.line.ex"></a><p class="title"><b>Example&nbsp;2.4.&nbsp;Line comments</b></p><div class="example-contents"><pre class="programlisting">
// A simple, one-line line comment

// This is
// a multi-line
// line comment

operator entry() {
  // comment can appear in source code
  report("Hello!"); // pretty much anywhere
  foo( 32 //, 53 ); // can't comment out code in the middle of the line
          ); // but you can continue it on the next line.
}
          </pre></div></div><br class="example-break"></div></div><div class="section" title="Tokens"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="syntax.tokens"></a>Tokens</h2></div></div></div><p>
        A KL program is <em class="glossterm">parsed</em> as a sequence of tokens.  A token is a sequence of characters that begins with something other than whitespace and is not a comment.  There are four categories of tokens in KL: keywords, identifiers, symbols, and constants.
      </p><div class="section" title="Keywords"><div class="titlepage"><div><div><h3 class="title"><a name="keywords"></a>Keywords</h3></div></div></div><p>
          The following is the list of all the keywords in KL:
          
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="code">alias</code></td><td><code class="code">do</code></td><td><code class="code">in</code></td><td><code class="code">switch</code></td></tr><tr><td><code class="code">break</code></td><td><code class="code">else</code></td><td><code class="code">io</code></td><td><code class="code">throw</code></td></tr><tr><td><code class="code">case</code></td><td><code class="code">false</code></td><td><code class="code">operator</code></td><td><code class="code">true</code></td></tr><tr><td><code class="code">const</code></td><td><code class="code">for</code></td><td><code class="code">require</code></td><td><code class="code">var</code></td></tr><tr><td><code class="code">continue</code></td><td><code class="code">function</code></td><td><code class="code">return</code></td><td><code class="code">while</code></td></tr><tr><td><code class="code">default</code></td><td><code class="code">if</code></td><td><code class="code">struct</code></td><td>&nbsp;</td></tr></table><p>
        </p><p>
          Keywords cannot be used as identifiers, ie. cannot be used for variable, parameter, function, constant or type names.
        </p></div><div class="section" title="Identifiers"><div class="titlepage"><div><div><h3 class="title"><a name="syntax.tokens.identifiers"></a>Identifiers</h3></div></div></div><p>
          Identifiers are a sequence of one or more characters that:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>begin with any of the characters <code class="code">a</code>...<code class="code">z</code>, <code class="code">A</code>...<code class="code">Z</code> or <code class="code">_</code>; and</p></li><li class="listitem"><p>are followed by zero or more of the characters <code class="code">a</code>...<code class="code">z</code>, <code class="code">A</code>...<code class="code">Z</code>, <code class="code">0</code>...<code class="code">9</code> or <code class="code">_</code>; and</p></li></ul></div><p>
        </p><p>
          Identifiers are used in KL for variable names, parameter names, function names, constant names, method names and type names.
          
          </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The built-in base types in KL (eg. <code class="code">Boolean</code>, <code class="code">String</code>, <code class="code">Float32</code>) are not keywords but rather identifiers.  This is a technical detail that is important in the design of the language grammar but doesn't make much difference in practice; it simply changes certain syntax errors into semantic errors.</p></td></tr></table></div><p>
        </p><p>
          Some examples of valid identifiers in KL:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">foo</code></p></li><li class="listitem"><p><code class="code">someVariable</code></p></li><li class="listitem"><p><code class="code">MyType</code></p></li><li class="listitem"><p><code class="code">MyTypeVersion2</code></p></li><li class="listitem"><p><code class="code">variable_with_underscores</code></p></li><li class="listitem"><p><code class="code">piBy2</code></p></li><li class="listitem"><p><code class="code">_</code></p></li></ul></div><p>
          
          Some examples of invalid identifiers:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">2by4</code></p></li><li class="listitem"><p><code class="code">my%Share</code></p></li><li class="listitem"><p><code class="code">peter.zion@fabric-engine.com</code></p></li></ul></div><p>
        </p></div><div class="section" title="Symbols"><div class="titlepage"><div><div><h3 class="title"><a name="syntax.tokens.symbols"></a>Symbols</h3></div></div></div><p>
          A small set of non-alphanumeric, non-underscore characters or short sequences of such characters are the symbols in KL.  They are specifically:

          </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="code">=</code></td><td><code class="code">-=</code></td><td><code class="code">%</code></td><td><code class="code">&amp;=</code></td><td><code class="code">]</code></td><td><code class="code">.</code></td><td><code class="code">&gt;=</code></td><td><code class="code">,</code></td></tr><tr><td><code class="code">==</code></td><td><code class="code">--</code></td><td><code class="code">%=</code></td><td><code class="code">&amp;&amp;</code></td><td><code class="code">(</code></td><td><code class="code">&lt;</code></td><td><code class="code">&gt;&gt;</code></td><td><code class="code">?</code></td></tr><tr><td><code class="code">+</code></td><td><code class="code">*</code></td><td><code class="code">^</code></td><td><code class="code">|</code></td><td><code class="code">)</code></td><td><code class="code">&lt;=</code></td><td><code class="code">&gt;&gt;=</code></td><td><code class="code">;</code></td></tr><tr><td><code class="code">+=</code></td><td><code class="code">*=</code></td><td><code class="code">^=</code></td><td><code class="code">|=</code></td><td><code class="code">{</code></td><td><code class="code">&lt;&lt;</code></td><td><code class="code">~</code></td><td>&nbsp;</td></tr><tr><td><code class="code">++</code></td><td><code class="code">/</code></td><td><code class="code">^^</code></td><td><code class="code">||</code></td><td><code class="code">}</code></td><td><code class="code">&lt;&lt;=</code></td><td><code class="code">!</code></td><td>&nbsp;</td></tr><tr><td><code class="code">-</code></td><td><code class="code">/=</code></td><td><code class="code">&amp;</code></td><td><code class="code">[</code></td><td><code class="code">;</code></td><td><code class="code">&gt;</code></td><td><code class="code">!=</code></td><td>&nbsp;</td></tr></table><p>
        </p><p>  
          The KL compiler is <span class="quote">“<span class="quote">greedy</span>”</span> when looking for symbols: it looks for the longest sequence of characters that are a valid symbol.  This is why <code class="code">==(</code> is treated as the two symbols <code class="code">==</code> and <code class="code">(</code>: there is no symbol starting with <code class="code">==(</code> but <code class="code">==</code> is a symbol.
        </p></div><div class="section" title="Constants"><div class="titlepage"><div><div><h3 class="title"><a name="constants"></a>Constants</h3></div></div></div><p>
          A constant is a token that is interpreted as a fixed value of a specific type. KL supports five types of constants: boolean constants, integer constants, floating-point constants, and string constants.  Each of these are explained below.
        </p><div class="section" title="Boolean Constants"><div class="titlepage"><div><div><h4 class="title"><a name="syntax.tokens.constants.boolean"></a>Boolean Constants</h4></div></div></div><p>
            The two keywords <code class="code">true</code> and <code class="code">false</code> are the two boolean constants.  They are each a value of type <code class="code">Boolean</code>.
          </p><div class="example"><a name="syntax.tokens.constants.boolean.ex"></a><p class="title"><b>Example&nbsp;2.5.&nbsp;Boolean constants</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Float32 value = 1.1;
  Index steps = 0;
  Boolean done = false;
  while (!done) {
    value *= value;
    if (value &gt; 2)
      done = true;
    ++steps;
  }
  report("took " + steps + " steps");
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><a name="syntax.tokens.constants.boolean.ex.out"></a><p>Output:</p><pre class="screen">
took 3 steps
            </pre></div></div><div class="section" title="Integer Constants"><div class="titlepage"><div><div><h4 class="title"><a name="syntax.tokens.constants.integer"></a>Integer Constants</h4></div></div></div><p>
            A integer constant can take one of three forms:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The single digit <code class="code">0</code></li><li class="listitem">A decimal constant that starts with a single digit in the range <code class="code">1</code>...<code class="code">9</code> followed by zero or more digits in the range <code class="code">0</code>...<code class="code">9</code></li><li class="listitem">The two characters <code class="code">0x</code> or <code class="code">0X</code> followed by one or more characters in one of the ranges <code class="code">0</code>...<code class="code">9</code>, <code class="code">a</code>...<code class="code">f</code> and <code class="code">A</code>...<code class="code">F</code></li></ul></div><p>
            
            The type of an integer constant depends on its value:
            
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                If it is less than <span class="mathphrase">2<sup>31</sup>-1</span> then it is of type <code class="code">Integer</code>;
              </p></li><li class="listitem"><p>
                If it is at least <span class="mathphrase">2<sup>31</sup></span> but less than <span class="mathphrase">2<sup>32</sup>-1</span> (on 32-bit platforms) or <span class="mathphrase">2<sup>64</sup>-1</span> (on 64-bit platforms) then it is of type <code class="code">Size</code>;
              </p></li><li class="listitem"><p>
                Otherwise, the integer constant is too large and the compiler will generate a syntax error.
              </p></li></ul></div><p>
            
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
              All integer constants are positive; a <code class="code">-</code> (minus sign) followed by an integer constant is interpreted as the unary minus operator applied to the integer constant.
            </p></td></tr></table></div><p>
          </p><div class="example"><a name="syntax.tokens.constants.integer.ex"></a><p class="title"><b>Example&nbsp;2.6.&nbsp;Integer constants</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report(0);
  report(1);
  report(123456789);
  report(0xA9);
  report(0xdeadBEEF);
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><a name="syntax.tokens.constants.integer.ex.out"></a><p>Output:</p><pre class="screen">
0
1
123456789
169
3735928559
            </pre></div></div><div class="section" title="Floating-Point Constants"><div class="titlepage"><div><div><h4 class="title"><a name="syntax.tokens.constants.floating-point"></a>Floating-Point Constants</h4></div></div></div><p>
            A floating-point constant takes the following form:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Either a single <code class="code">0</code> or one digit in the range <code class="code">1</code>...<code class="code">9</code> followed by zero or more digits in the range <code class="code">0</code>...<code class="code">9</code> (the <em class="glossterm">whole part</em>; the same syntax as a decimal integer constant)...</li><li class="listitem">...optionally followed by a <code class="code">.</code> and zero or more characters in the range <code class="code">0</code>...<code class="code">9</code> (the <em class="glossterm">fractional part</em>)...</li><li class="listitem">...optionally followed by an <code class="code">e</code> or an <code class="code">E</code>, then optionally by a <code class="code">+</code> or a <code class="code">-</code>, then by one or more characters in the range <code class="code">0</code>...<code class="code">9</code> (the <em class="glossterm">exponent</em>).</li></ul></div><p>
            
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>C accepts floating-point constants that start with a <code class="code">.</code> but floating-point constants in KL must start with a digit</p></td></tr></table></div><p>
            
            However, for a constant to be floating-point (and not integer) it must have a fractional part, an exponent, or both.
            
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
              It is not possible to represent many decimal fractional expressions in IEEE floating point format.  As such, do not be surprised if the output values of such expressions appear to be slightly off, as seen in the example below with the constant <code class="code">8.9e-6</code>.
            </p></td></tr></table></div><p>
          </p><p>
            In KL, all floating-point constants are of type <code class="code">Float64</code>, regardless of value.
            
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
              All floating-point constants are positive; a <code class="code">-</code> (minus sign) followed by a floating-point constant is interpreted as the unary minus operator applied to the floating-point constant.
            </p></td></tr></table></div><p>
          </p><div class="example"><a name="d5e516"></a><p class="title"><b>Example&nbsp;2.7.&nbsp;Floating-point constants</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report(0.0);
  report(1.4142);
  report(3.14159265358979);
  report(8.9e-6);
  report(4356.123E42);
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
0
1.4142
3.14159265358979
8.899999999999999e-06
4.356123e+45
            </pre></div></div><div class="section" title="String Constants"><div class="titlepage"><div><div><h4 class="title"><a name="syntax.tokens.constants.string"></a>String Constants</h4></div></div></div><p>
            A <em class="glossterm">string constant</em> is a constant value of type <code class="code">String</code>.  It takes one of the following forms:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                A sequence of characters, possibly including string constant escape sequences (described below), enclosed in a pair of <code class="code">"</code> (<span class="quote">“<span class="quote">double-quote</span>”</span>) characters; or
              </p></li><li class="listitem"><p>
                A sequence of characters, possibly including string constant escape sequences (described below), enclosed in a pair of <code class="code">'</code> (<span class="quote">“<span class="quote">single-quote</span>”</span>) characters; or
              </p></li></ul></div><p>
            
            A <em class="glossterm">string constant escape sequence</em> is one of the following sequences of characters, describing what the sequence is replaced by in the string: 
            
            </p><div class="variablelist"><dl><dt><span class="term"><code class="code">\n</code></span></dt><dd>a single newline (ASCII 10) character</dd><dt><span class="term"><code class="code">\f</code></span></dt><dd>a single form feed (ASCII 12) character</dd><dt><span class="term"><code class="code">\r</code></span></dt><dd>a single carriage return (ASCII 13) character</dd><dt><span class="term"><code class="code">\t</code></span></dt><dd>a single carriage tab (ASCII 9) character</dd><dt><span class="term"><code class="code">\v</code></span></dt><dd>a single vertical tab (ASCII 11) character</dd><dt><span class="term"><code class="code">\a</code></span></dt><dd>a single bell (ASCII 7) character</dd><dt><span class="term"><code class="code">\b</code></span></dt><dd>a single backspace (ASCII 8) character</dd><dt><span class="term"><code class="code">\0</code></span></dt><dd>a single null (ASCII 0) character</dd><dt><span class="term"><code class="code">\"</code></span></dt><dd>a single double-quote (ASCII 34) character</dd><dt><span class="term"><code class="code">\'</code></span></dt><dd>a single single-quote (ASCII 39) character</dd><dt><span class="term"><code class="code">\\</code></span></dt><dd>a single backslash (ASCII 92) character</dd><dt><span class="term"><code class="code">\x<em class="replaceable"><code>HH</code></em></code></span></dt><dd><p>
                  A single character whose ASCCI code is given in hexadecimal.  The two characters <code class="code"><em class="replaceable"><code>HH</code></em></code> must each be a hexadecimal character, ie. in one of the ranges <code class="code">0</code>...<code class="code">9</code>, <code class="code">a</code>...<code class="code">f</code> and <code class="code">A</code>...<code class="code">F</code>.  For example, the escape sequence <code class="code">0x0A</code> (decimal 10) is equivalent to the escape sequence <code class="code">\n</code> (ASCII 10).
                </p></dd></dl></div><p>
          </p><div class="example"><a name="syntax.tokens.constants.string.ex"></a><p class="title"><b>Example&nbsp;2.8.&nbsp;String constants</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report("double-quoted!");
  report('single-quoted\nwith a newline');
  report("double-quoted containing \"double quotes\"");
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><a name="syntax.tokens.constants.string.ex.out"></a><p>Output:</p><pre class="screen">
double-quoted!
single-quoted
with a newline
double-quoted containing "double quotes"
            </pre></div></div></div></div><div class="section" title="Program Structure"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="syntax.structure"></a>Program Structure</h2></div></div></div><p>
        A KL program consists of zero or more <em class="glossterm">global declarations</em> in sequence.  A global declaration is one of:
        
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            A declaration of a function, a function prototype, an operator, a method or an operator overload; see <a class="xref" href="#functions" title="Function Definitions">the section called “Function Definitions”</a>.
          </p></li><li class="listitem"><p>
            A declaration of structure; see <a class="xref" href="#structs" title="Structures">the section called “Structures”</a>.
          </p></li><li class="listitem"><p>
            A declaration of global constant; see <a class="xref" href="#global-constants" title="Global Constants">the section called “Global Constants”</a>.
          </p></li><li class="listitem"><p>
            A <code class="code">require</code> statement; see <a class="xref" href="#use" title="Importing Functionality With require">the section called “Importing Functionality With <code class="code">require</code>”</a>.
          </p></li></ul></div><p>
      </p><p>
        In turn, functions, operators, and other similar constructs consist of zero or more <em class="glossterm">statements</em>.  Each statement is terminated with a <code class="code">; </code> (semicolon) character.  For more detailed information on all the statements available in KL, see <a class="xref" href="#statements" title="Chapter&nbsp;6.&nbsp;Statements">Chapter&nbsp;6, <i>Statements</i></a>.
      </p><p>
        A sequence of statements, surrounded by braces (a <code class="code">{</code> and a <code class="code">}</code>), can take the place of a single statement.  This also introduces a nested scope; for more information, see <a class="xref" href="#scope.compound-statement" title="Compound Statement Scope">the section called “Compound Statement Scope”</a>.
      </p></div></div><div class="chapter" title="Chapter&nbsp;3.&nbsp;The KL Type System"><div class="titlepage"><div><div><h2 class="title"><a name="types"></a>Chapter&nbsp;3.&nbsp;The KL Type System</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#types.base">Base Types</a></span></dt><dd><dl><dt><span class="section"><a href="#types.base.boolean">The <code class="code">Boolean</code> Type</a></span></dt><dt><span class="section"><a href="#integers">Integer Types</a></span></dt><dt><span class="section"><a href="#types.base.floating-point">Floating-Point Types</a></span></dt><dt><span class="section"><a href="#string-type">The <code class="code">String</code> Type</a></span></dt></dl></dd><dt><span class="section"><a href="#types.derived">Derived Types</a></span></dt><dd><dl><dt><span class="section"><a href="#structs">Structures</a></span></dt><dt><span class="section"><a href="#arrays">Arrays</a></span></dt><dt><span class="section"><a href="#dicts">Dictionaries</a></span></dt><dt><span class="section"><a href="#map-reduce-types">Map-Reduce Types</a></span></dt></dl></dd><dt><span class="section"><a href="#types.aliases">Type Aliases</a></span></dt><dt><span class="section"><a href="#types.data">The <code class="code">Data</code> Type and the <code class="code">data</code> and <code class="code">dataSize</code> Methods</a></span></dt></dl></div><p>
      Unlike most languages, KL has a dynamic type system that is inherited from the Fabric environment.  In most cases, compound types are registered from the Fabric environment running in a dynamic language (eg. JavaScript or Python); those types are then automatically made available to KL programs running in that environment.  This does not, however, affect the semantics of the language; the KL type system can still be explained purely from the point of view of the language itself.
    </p><p>
      Like most programming languages, KL has support for both a fixed set of base types from which other types are derived as well as different kinds of derived types.
    </p><div class="section" title="Base Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="types.base"></a>Base Types</h2></div></div></div><p>
        The base types in KL are the following:

        </p><div class="variablelist"><dl><dt><span class="term"><code class="code">Boolean</code></span></dt><dd><p>can be either <code class="code">true</code> or <code class="code">false</code></p></dd><dt><span class="term"><code class="code">Byte</code></span></dt><dd><p>an 8-bit unsigned integer</p></dd><dt><span class="term"><code class="code">Integer</code></span></dt><dd><p>a 32-bit signed integer</p></dd><dt><span class="term"><code class="code">Size</code></span></dt><dd><p>an unsigned integer that is 32-bit on 32-bit platforms and 64-bit on 64-bit platforms.  <code class="code">Size</code> is usually used to either index into or count the number of elements in an array</p></dd><dt><span class="term"><code class="code">Index</code></span></dt><dd><p>an alias for <code class="code">Size</code></p></dd><dt><span class="term"><code class="code">Float32</code></span></dt><dd><p>a 32-bit IEEE floating point</p></dd><dt><span class="term"><code class="code">Scalar</code></span></dt><dd><p>an alias for <code class="code">Float32</code></p></dd><dt><span class="term"><code class="code">Float64</code></span></dt><dd><p>a 64-bit IEEE floating point</p></dd><dt><span class="term"><code class="code">String</code></span></dt><dd><p>a sequence of zero or more characters</p></dd></dl></div><p>
      </p><div class="section" title="The Boolean Type"><div class="titlepage"><div><div><h3 class="title"><a name="types.base.boolean"></a>The <code class="code">Boolean</code> Type</h3></div></div></div><p>
          The value of an expression of <code class="code">Boolean</code> type is either logical true or logical false.  The type has the following properties:

          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              The constants <code class="code">true</code> and <code class="code">false</code> are <code class="code">Boolean</code> values with logical values true and false, respectively.
            </p></li><li class="listitem"><p>
              All other base types cast to Boolean as follows:
              
              </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><code class="code">Byte</code>, <code class="code">Integer</code> and <code class="code">Size</code> values cast to true if and only if the value is non-zero</p></li><li class="listitem"><p><code class="code">Float32</code> and <code class="code">Float64</code> values cast true if and only if the value is not equal to <code class="code">0.0</code> or <code class="code">-0.0</code></p></li><li class="listitem"><p><code class="code">String</code> values cast to true if and only if their length is greater than zero</p></li><li class="listitem"><p>arrays and dictionaries cast to true if and only if they are non-empty</p></li><li class="listitem"><p>by default, structures do not cast to <code class="code">Boolean</code>, but you can implement the cast if desired by creating a <code class="code">Boolean</code> constructor that takes the structure as a parameter; see <a class="xref" href="#constructors" title="Constructors">the section called “Constructors”</a></p></li></ul></div><p>
            </p></li><li class="listitem"><p>
              For operators:
              
              </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>None of the arithmetic operators (binary <code class="code">+</code>, <code class="code">-</code>, <code class="code">*</code>, <code class="code">/</code>, <code class="code">%</code> as well as unary <code class="code">-</code> and <code class="code">+</code>) are valid for <code class="code">Boolean</code> values</p></li><li class="listitem"><p>Only the <code class="code">==</code> and <code class="code">!=</code> comparison operators are valid for <code class="code">Boolean</code> values</p></li><li class="listitem"><p>All of the bitwise binary operators (<code class="code">|</code>, <code class="code">&amp;</code>, <code class="code">^</code> and <code class="code">~</code>) are valid for <code class="code">Boolean</code> values and treat the value as if were a single bit</p></li></ul></div><p>
            </p></li></ul></div><p>
        </p><div class="example"><a name="types.base.boolean.ex"></a><p class="title"><b>Example&nbsp;3.1.&nbsp;The <code class="code">Boolean</code> type</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Boolean a = true;
  report(a);
  Boolean b = a &amp; false;
  report(b);
  report(a != b);
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.base.boolean.ex.out"></a><p>Output:</p><pre class="screen">
true
false
true              
          </pre></div></div><div class="section" title="Integer Types"><div class="titlepage"><div><div><h3 class="title"><a name="integers"></a>Integer Types</h3></div></div></div><p>
          The <code class="code">Byte</code>, <code class="code">Integer</code> and <code class="code">Size</code> types (collectively known as <em class="glossterm">integer types</em>) represent whole integers.  These types differ only in their bit width and whether they are signed or unsigned, as follows:
          
          </p><div class="variablelist"><dl><dt><span class="term"><code class="code">Byte</code></span></dt><dd>an 8-bit unsigned integer</dd><dt><span class="term"><code class="code">Integer</code></span></dt><dd>a 32-bit signed integer</dd><dt><span class="term"><code class="code">Size</code></span></dt><dd>an unsigned integer that is 32-bit on 32-bit systems and 64-bit on 64-bit systems</dd><dt><span class="term"><code class="code">Index</code></span></dt><dd>an alias for <code class="code">Size</code></dd></dl></div><p>
        </p><p>
          Integer types behave as follows:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              Integer constants (eg. <code class="code">43562</code>) are of type <code class="code">Integer</code> if their value is less than <span class="mathphrase">2<sup>31</sup>-1</span>, otherwise they are of type <code class="code">Size</code>.  For more details, see <a class="xref" href="#syntax.tokens.constants.integer" title="Integer Constants">the section called “Integer Constants”</a>.
            </li><li class="listitem"><p>
              All of the <a class="link" href="#arithmetic-ops" title="Arithmetic Operators">arithmetic</a>, <a class="link" href="#logical-ops" title="Logical Operators">logical</a> and <a class="link" href="#bitwise-ops" title="Bitwise Operators">bitwise</a> operators work as expected for all integer types.
              
              </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
                The result of applying the unary <code class="code">-</code> (minus) operator to a <code class="code">Byte</code> or a <code class="code">Size</code> is still a positive number; it is the resulting unsigned integer that, when added to the original, results in 0 because of the type <span class="quote">“<span class="quote">wrapping around</span>”</span>.
              </p></td></tr></table></div><p>
            </p></li></ul></div><p>
        </p><div class="example"><a name="types.base.integers.ex"></a><p class="title"><b>Example&nbsp;3.2.&nbsp;Integer types</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Byte b = 64;
  report(b);
  Size s = 45 * Size(b) + 32;
  report(s);
  Integer i = -75 * Integer(s) + 18;
  report(i);
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.base.integers.ex.out"></a><p>Output:</p><pre class="screen">
64
2912
-218382
          </pre></div></div><div class="section" title="Floating-Point Types"><div class="titlepage"><div><div><h3 class="title"><a name="types.base.floating-point"></a>Floating-Point Types</h3></div></div></div><p>
          The <code class="code">Float32</code>, <code class="code">Float64</code> and <code class="code">Scalar</code> types (collectively known as <em class="glossterm">floating-point types</em>) represent <acronym class="acronym">IEEE</acronym> floating-point numbers.  These types differ only in their bit width, as follows:
          
          </p><div class="variablelist"><dl><dt><span class="term"><code class="code">Float32</code></span></dt><dd>a 32-bit <acronym class="acronym">IEEE</acronym> floating-point number</dd><dt><span class="term"><code class="code">Float64</code></span></dt><dd>a 64-bit <acronym class="acronym">IEEE</acronym> floating-point number</dd><dt><span class="term"><code class="code">Scalar</code></span></dt><dd><p>
                an alias for <code class="code">Float32</code>
                </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The <code class="code">Scalar</code> alias will probably be removed in a future version of KL.  We recommend that you not use it in any new code.</p></td></tr></table></div><p>
              </p></dd></dl></div><p>
        </p><p>
          Floating-point types behave as follows:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              Floating-point constants have the same syntax as in JavaScript and C, and are of type <code class="code">Float64</code>.  For more details, see <a class="xref" href="#syntax.tokens.constants.floating-point" title="Floating-Point Constants">the section called “Floating-Point Constants”</a>.
            </p></li><li class="listitem"><p>
              All of the arithmetic and comparison operators are valid for floating-point values.  None of the bitwise operators are valid for floating-point values.
            </p></li></ul></div><p>
        </p><div class="example"><a name="types.base.floating-points.ex"></a><p class="title"><b>Example&nbsp;3.3.&nbsp;Floating-point types</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Float32 x = 3.141;
  report(x);
  Float64 y = 2.718;
  report(y);
  Float32 z = x*x + y*y;
  report(z);
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.base.floating-points.ex.out"></a><p>Output:</p><pre class="screen">
3.141
2.718
17.2534
          </pre></div></div><div class="section" title="The String Type"><div class="titlepage"><div><div><h3 class="title"><a name="string-type"></a>The <code class="code">String</code> Type</h3></div></div></div><p>
          The <code class="code">String</code> type represents a text string, ie. a sequence of zero or more characters.  A value of type <code class="code">String</code> is referred to as a <em class="glossterm">string value</em>.
        </p><p>          
          The semantics of the <code class="code">String</code> type in KL are important to understand.  Strings have the following key properties:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">A string is a sequence of zero or more characters.</li><li class="listitem">The length of a string is value of type <code class="code">Size</code>, and the maximum length of a string is the maximum value of type <code class="code">Size</code>.</li><li class="listitem"><p>
              String constants can be specified inline in KL source files using single- or double-quotation marks, just as JavaScript.  For more details and examples of string constants, see <a class="xref" href="#syntax.tokens.constants.string" title="String Constants">the section called “String Constants”</a>.
            </p></li><li class="listitem">Strings are <span class="emphasis"><em>reference-counted</em></span> and <span class="emphasis"><em>copy-on-write</em></span>.  This means that if you assign a string value to multiple variables, there is only one copy of the actual string until someone changes one of the strings.</li><li class="listitem"><p>
              Strings support the following operations and properties, which are all exactly the same as JavaScript:
              </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">They have a <span class="property">.length</span> property which returns the number of characters in the string</li><li class="listitem">The <code class="code">+=</code> assignment operator is used to append another string to a given string</li><li class="listitem">A new string can be created by concatenating two other strings using the <code class="code">+</code> binary operation</li><li class="listitem">Strings can be compared using the usual <code class="code">==</code>, <code class="code">!=</code>, <code class="code">&lt;</code>, <code class="code">&lt;=</code>, <code class="code">&gt;</code> and <code class="code">&gt;=</code> logical operators.</li></ul></div><p>
            </p></li><li class="listitem">Unlike C or C++, strings can contain the null character (ASCII 0).</li><li class="listitem">Strings have no notion of encoding; they are just sequences of bytes.  String encodings are determined by the application space where the strings are used.  Note that everything in Fabric itself uses the UTF-8 encoding, but Fabric extensions may need to convert strings into other encodings.</li><li class="listitem">All other types in KL can be converted to strings through a cast; this conversion simply creates a string that is a human-readable version of the value.</li></ul></div><p>
        </p><div class="example"><a name="types.base.string.ex"></a><p class="title"><b>Example&nbsp;3.4.&nbsp;String type</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  String a = "A string";
  report(a);
  report("a has length " + a.length);
  String b = "Another string";
  report(b);
  String c = a + " and " + b;
  report(c);
  b += " now includes " + a;
  report(b);
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.base.string.ex.out"></a><p>Output:</p><pre class="screen">
A string
a has length 8
Another string
A string and Another string
Another string now includes A string
          </pre></div></div></div><div class="section" title="Derived Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="types.derived"></a>Derived Types</h2></div></div></div><p>
        In addition to the base types, KL supports three classes of derived types: structures, arrays and dictionaries.
      </p><div class="section" title="Structures"><div class="titlepage"><div><div><h3 class="title"><a name="structs"></a>Structures</h3></div></div></div><p>
          A <em class="glossterm">structure</em> is a collection of typed values that are placed together in memory.
        </p><p>
          Structures are usually defined outside of KL using Fabric's <em class="glossterm">registered type system</em>, but they can also be declared in KL source code itself using the <code class="code">struct</code> keyword:
          
          </p><div class="informalexample"><pre class="programlisting">
struct NewType {
  Float32 firstMember;
  String secondMember;
  Integer thirdMemberVarArray[];
};
            </pre></div><p>

          Note the use of the variable-size array as the last member; derived types can nest arbitrarily.

          </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>All structure declarations in KL must be in the global scope; it is not possible to declare a structure within a function scope.</p></td></tr></table></div><p>
        </p><p>
          More details about structures:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Access to structure members is through the <code class="code">.</code> (dot) operator, as in JavaScript.</li><li class="listitem">Currently, the structure members are <em class="glossterm">packed</em>, meaning that there is no space in member between the structure members.  In a future version of Fabric it will be possible to explicitly specify structure member alignment and packing.</li><li class="listitem">It is possible to overload operators and add <em class="glossterm">methods</em> to structures; see <a class="xref" href="#methods" title="Methods">the section called “Methods”</a>.</li></ul></div><p>
        </p><div class="example"><a name="types.derived.struct.use.ex"></a><p class="title"><b>Example&nbsp;3.5.&nbsp;Structure use</b></p><div class="example-contents"><pre class="programlisting">
struct MyNewType {
  Integer i;
  String s;
};

function entry() {
  MyNewType mnt;
  mnt.s = "Hello!";
  mnt.i = 42;
  report(mnt);
}
          </pre></div></div><br class="example-break"><div class="informalexample"><a name="types.derived.struct.use.ex.out"></a><p>Output:</p><pre class="screen">
{i:42,s:"Hello!"}
          </pre></div></div><div class="section" title="Arrays"><div class="titlepage"><div><div><h3 class="title"><a name="arrays"></a>Arrays</h3></div></div></div><p>
          An <em class="glossterm">array</em> is a sequence of values of the same type (referred to as the array's <em class="glossterm">element type</em>) that are indexed by integers and placed sequentially in memory.  KL supports three types of arrays: variable-size arrays, fixed-length arrays, and sliced arrays.  The details of each array type are discussed below.
        </p><p><a name="array-properties"></a>
          Regardless of specific type, arrays in KL have several common behaviours:
      
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                Arrays are indexed using the <code class="code">[</code>..<code class="code">]</code> operator, exactly as in JavaScript and C.  The indexing of arrays is 0-based, again just as in JavaScript and C.
              
                </p><div class="informalexample"><pre class="programlisting">
Size sizes[];    // Declare a variable-size array
sizes.push(42);  // Push some elements onto the end of the array
sizes.push(21);
sizes.push(3);
report(sizes[1]); // outputs "21"
                  </pre></div><p>
              </p></li><li class="listitem">The size of an array is of type <code class="code">Size</code> and the indexing operator takes an index of type <code class="code">Index</code> (which is an alias for <code class="code">Size</code>).</li><li class="listitem"><p>
                Array declarations can be nested, and can be co-nested with other array types.
                </p><div class="informalexample"><pre class="programlisting">
Integer b[][];  // A variable-size array of variable-size arrays of integers
Boolean a[2][]; // An array of 2 variable-size arrays of booleans
String c&lt;&gt;[];   // A sliced array of variable-size 
                  </pre></div><p>
              </p></li><li class="listitem">
                Arrays are <em class="glossterm">passed by reference</em> into functions and operators, ie. they are not copied.  This means that it takes just a long to pass an array with one million elements to a function as it does to pass an array with one element.
              </li><li class="listitem">
                When running within a web browser, indexing into arrays using the indexing operator is bounds-checked; if the index runs off the end of the array, an exception is thrown.  When running Fabric from the command line, arrays are not bounds-checked.
              </li></ul></div><p>
        </p><div class="section" title="Variable-Size Arrays"><div class="titlepage"><div><div><h4 class="title"><a name="types.derived.arrays.variable"></a>Variable-Size Arrays</h4></div></div></div><p>
            A <em class="glossterm">variable-size array</em> is an array whose size can be changed at runtime.  Variable-size arrays are declared by appending <code class="code">[]</code> to the name of the variable, parameter or structure member where they are declared, eg. <code class="code">String strings[]</code>.
          </p><p>
            Variable-size arrays have all the <a class="link" href="#array-properties">properties of arrays</a> as well as the following additional properties:
          
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                The maximum size of a variable-size array is the maximum value of the <code class="code">Size</code> type.  This means that variable-size arrays can be much larger on 64-bit machines than they can on 32-bit machines.
              </p></li><li class="listitem"><p>
                Variable-size arrays are <em class="glossterm">duplicate-on-modify</em>, meaning that it is inexpensive to assign one variable-size array to another but as soon as one of the <span class="quote">“<span class="quote">copies</span>”</span> is modified the contents are duplciated.
              </p></li><li class="listitem"><p>
                Variable-size arrays support the following methods:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">The <code class="code">push(element)</code> method appends an element to the end of the variable-size array</li><li class="listitem">The <code class="code">size()</code> method returns the number of elements in the variable-size array</li><li class="listitem">The <code class="code">resize(newSize)</code> method resizes the array.  Any new elements at the end are initialized with the default value for the underlying type.</li></ul></div><p>
              </p></li></ul></div><p>
          </p><div class="example"><a name="types.derived.arrays.variable.ex"></a><p class="title"><b>Example&nbsp;3.6.&nbsp;Variable-size arrays</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Integer a[];
  report("The array a has size " + a.size + " and value " + a);
  a.push(42);
  a.push(84);
  report("The array NOW has size " + a.size + " and value " + a);
  a.resize(4);
  report("The array NOW has size " + a.size + " and value " + a);
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.derived.arrays.variable.ex.out"></a><p>Output:</p><pre class="screen">
The array a has size 0 and value []
The array NOW has size 2 and value [42,84]
The array NOW has size 4 and value [42,84,0,0]
            </pre></div></div><div class="section" title="Fixed-Size Arrays"><div class="titlepage"><div><div><h4 class="title"><a name="types.derived.arrays.fixed"></a>Fixed-Size Arrays</h4></div></div></div><p>
            A <em class="glossterm">fixed-size array</em> is an array whose size is fixed at runtime.  Fixed-size arrays have much faster performance characteristics than variable-size arrays, therefore should be used in place of variable-sized arrays when the size of an array is known at compile time.  Fixed-size arrays are declared by appending <code class="code">[<em class="replaceable"><code>size</code></em>]</code> to the name of the variable, parameter or structure member where they are declared, eg. <code class="code">String strings[4]</code>.
          </p><p>
            Fixed-size arrays have all the <a class="link" href="#array-properties">properties of arrays</a> as well as the following additional properties:
          
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                The maximum size of a fixed-size array is the maximum value of the <code class="code">Size</code> type.
                </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Since fixed-size arrays are allocated on the stack (instead of the heap), using very large fixed-size arrays may result in a stack overflow.  It is recommended that fixed-size arrays only be used for arrays that are reasonably small.</p></td></tr></table></div><p>              
              </p></li><li class="listitem"><p>
                Fixed-size arrays are copied when they are assigned.
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Unlike variable-size arrays, this behaviour of fixed-size arrays will never change.</p></td></tr></table></div><p>
              </p></li></ul></div><p>
          </p><div class="example"><a name="types.derived.arrays.fixed.ex"></a><p class="title"><b>Example&nbsp;3.7.&nbsp;Fixed-size arrays</b></p><div class="example-contents"><pre class="programlisting">
function Float32 det(Float32 mat[2][2]) {
  return mat[0][0] * mat[1][1] - mat[0][1] * mat[1][0];
}

operator entry() {
  Float32 mat[2][2];
  mat[0][0] = 3.5;
  mat[0][1] = -9.2;
  mat[1][0] = -2.1;
  mat[1][1] = 8.6;
  report("The determinant of " + mat + " is " + det(mat));
}
            </pre></div></div><br class="example-break"><div class="informalexample"><a name="types.derived.arrays.fixed.ex.out"></a><p>Output:</p><pre class="screen">
The determinant of [[3.5,-9.2],[-2.1,8.6]] is 10.78
            </pre></div></div><div class="section" title="Sliced Arrays"><div class="titlepage"><div><div><h4 class="title"><a name="types.derived.arrays.sliced"></a>Sliced Arrays</h4></div></div></div><p>
            A <em class="glossterm">sliced array</em> is an array whose size is fixed when it is created.  Sliced arrays have the unique feature that new sliced arrays can be created that access a sub-range of the elements of an existing sliced array.  Sliced arrays are primarily used for operator parameters bound to sliced data inside Fabric's dependency graph, but can also be used on their own within KL.  Sliced arrays are declared by appending <code class="code">&lt;&gt;</code> to the name of the variable, parameter or structure member where they are declared, eg. <code class="code">String strings&lt;&gt;</code>.
          </p><p>
            Sliced arrays have all the <a class="link" href="#array-properties">properties of arrays</a> as well as the following additional properties:
          
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                Within KL, sliced arrays can only be created using one of two syntaxes, shown in the example below:
                
                </p><div class="informalexample"><pre class="programlisting">
Size sizes&lt;&gt;(8);                // Create a sliced array of 8 elements of type Size
for (Size i=0; i&lt;8; ++i)
  sizes[i] = i;
  
Size subSizes&lt;&gt;( sizes, 2, 4 ); // A sliced array of elements of type Size that accesses
                                // elements 2 through 5 (inclusive) of the underlying
                                // sliced array
report(subSizes[0]);            // will output '2'
report(subSizes.size);          // will output '4'
                  </pre></div><p>
              </p></li><li class="listitem"><p>
                Sliced arrays as a whole cannot be the target of an assignment.  However, an element of a sliced array (accessed through the <code class="code">[</code>...<code class="code">]</code> index operator) can be assigned to.
              </p></li><li class="listitem"><p>
                Sliced arrays support the following methods:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">The <code class="code">size()</code> method returns the number of elements in the sliced array.  If a sliced array refers to a subrange of another sliced array, the value returned is the size of the subrange.</li></ul></div><p>
              </p></li></ul></div><p>
          </p><div class="example"><a name="types.derived.arrays.sliced.ex"></a><p class="title"><b>Example&nbsp;3.8.&nbsp;Sliced arrays</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  String strings&lt;&gt;(8);
  for (Size i=0; i&lt;8; ++i)
    strings[i] = "string " + (i+1);
  report("strings = " + strings);
  
  String subStrings&lt;&gt;(strings, 2, 4);
  report("subStrings = " + subStrings);
  
  report("Replacing subStrings element...");
  subStrings[3] = "replaced string";
  report("subStrings = " + subStrings);
  report("strings = " + strings);
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.derived.arrays.sliced.ex.out"></a><p>Output:</p><pre class="screen">
strings = ["string 1","string 2","string 3","string 4","string 5","string 6","string 7","string 8"]
subStrings = ["string 3","string 4","string 5","string 6"]
Replacing subStrings element...
subStrings = ["string 3","string 4","string 5","replaced string"]
strings = ["string 1","string 2","string 3","string 4","string 5","replaced string","string 7","string 8"]
            </pre></div></div></div><div class="section" title="Dictionaries"><div class="titlepage"><div><div><h3 class="title"><a name="dicts"></a>Dictionaries</h3></div></div></div><p>
          KL supports key-value pair dictionaries.  The type of the key of a dictionary can be any of the KL base types (e.g. <code class="code">Boolean</code>, <code class="code">String</code>, or any integer or floating-point type) and the type of the value can be any type.  Dictionaries are declared by appending <code class="code">[<em class="replaceable"><code>KeyType</code></em>]</code> to the variable, parameter or member name.  For example:
        
          </p><div class="informalexample"><pre class="programlisting">
String scalarToString[Float32];     // A Float32-to-String dictionary
Boolean integerToBoolean[Integer];  // An Integer-to-Boolean dictionary
          </pre></div><p>
        </p><p>
          Dictionaries in KL have the following properties:
        
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              Dictionaries are <em class="glossterm">duplicate-on-modify</em>, meaning that it is inexpensive to assign one dictionary to another but as soon as one of the <span class="quote">“<span class="quote">copies</span>”</span> is modified the contents are duplciated.
            </p></li><li class="listitem"><p>
              Dictionaries can be nested, and can be co-nested with array types.  For example:
            
              </p><div class="informalexample"><pre class="programlisting">
Integer b[String][2]; // An String-to-Fixed-Length-Integer-Array dictionary
Boolean a[][Integer]; // A variable array of Integer-to-Boolean dictionaries
              </pre></div><p>
            </p></li><li class="listitem"><p>There is no limit to the size of dictionaries other than available memory</p></li><li class="listitem"><p><a name="dict-indexing"></a>
              Dictionaries support indexing using the <code class="code">[<em class="replaceable"><code>key</code></em>]</code> indexing operator to both return the element at the give key or assign to the element at the given key.  When retrieving a value from a dictionary, if there is no value for the given key then an exception is thrown.</p></li><li class="listitem"><p>Dictionaries support the <code class="code">has(<em class="replaceable"><code>key</code></em>)</code> method that returns a <code class="code">Boolean</code> value indicating whether there is a value in the dictionary for the given key.</p></li><li class="listitem"><p>Dictionaries support the <code class="code">delete(<em class="replaceable"><code>key</code></em>)</code> method that deletes the value for the given key.  If there is no value for the given key, nothing happens.</p></li><li class="listitem"><p>
              Dictionaries can be iterated over using JavaScript-like <code class="code">in</code> iteration:
            
              </p><div class="informalexample"><pre class="programlisting">
String dict[String];
for (k in dict)
  report("dict[" + k + "] = " + dict[k]);
              </pre></div><p>
            
              For improved performance, both the key and value can be made available through <code class="code">in</code> iteration.  The value can be assigned to if and only if the dictionary can be assigned to.  For example:
            
              </p><div class="informalexample"><pre class="programlisting">
String dict[String];
for (k, v in dict)
  report("dict[" + k + "] = " + v);
              </pre></div><p>
            </p></li><li class="listitem"><p>
              Insertion order (not sort order!) is the iteration order for dictionaries, just as for JavaScript objects.

              </p><div class="informalexample"><pre class="programlisting">
operator entry() {
  String numbers[Integer];
  numbers[3] = "three";
  numbers[2] = "two";
  report(numbers); // outputs '{3:"three",2:"two"}'
  numbers[1] = "one";
  report(numbers); // outputs '{3:"three",2:"two",1:"one"}'
}
              </pre></div><p>
            </p></li></ul></div><p>
        </p><div class="example"><a name="types.derived.dicts.ex"></a><p class="title"><b>Example&nbsp;3.9.&nbsp;Dictionaries</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Float32 a[String];
  a['pi'] = 3.14;
  a['e'] = 2.71;
  report("a is:");
  for ( k, v in a ) {
    report("a['" + k + "'] = " + v);
  }
  a.delete('pi');
  report("a is now:");
  for ( k, v in a ) {
    report("a['" + k + "'] = " + v);
  }
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.derived.dicts.ex.out"></a><p>Output:</p><pre class="screen">
a is:
a['pi'] = 3.14
a['e'] = 2.71
a is now:
a['e'] = 2.71
        </pre></div></div><div class="section" title="Map-Reduce Types"><div class="titlepage"><div><div><h3 class="title"><a name="map-reduce-types"></a>Map-Reduce Types</h3></div></div></div><p>
          There are two additional derived types used exclusively for work within Fabric's map-reduce framework, namely:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">ValueProducer&lt;<em class="replaceable"><code>Type</code></em>&gt;</code></p></li><li class="listitem"><p><code class="code">ArrayProducer&lt;<em class="replaceable"><code>Type</code></em>&gt;</code></p></li></ul></div><p>
          
          For more information, see <a class="xref" href="#map-reduce" title="Chapter&nbsp;7.&nbsp;Map-Reduce">Chapter&nbsp;7, <i>Map-Reduce</i></a>.
        </p></div></div><div class="section" title="Type Aliases"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="types.aliases"></a>Type Aliases</h2></div></div></div><p>
        The <code class="code">alias</code> statement can be used to alias a type to make code more readable.  Its syntax is the same as a variable declaration:
        
        </p><pre class="programlisting">
alias Integer Int32;        // Int32 is now an alias for Integer
alias Float32 float;        // float is now an alias for Float32
alias Float32 Mat22[2][2];  // Mat22 is now an alias for Float32[2][2], ie. a size-2-array-of-size-2-arrays-of-Float32
        </pre><p>
        
        <code class="code">alias</code> statements must appear within the global scope of a KL program.
      </p><div class="example"><a name="types.aliases.ex"></a><p class="title"><b>Example&nbsp;3.10.&nbsp;Type aliases</b></p><div class="example-contents"><pre class="programlisting">
alias Float32 Mat22[2][2];

operator entry() {
  Mat22 mat22;
  report(mat22);
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.aliases.ex.out"></a><p>Output:</p><pre class="screen">
[[0,0],[0,0]]
      </pre></div></div><div class="section" title="The Data Type and the data and dataSize Methods"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="types.data"></a>The <code class="code">Data</code> Type and the <code class="code">data</code> and <code class="code">dataSize</code> Methods</h2></div></div></div><p>
        When interfacing with external libraries such as OpenGL, it is sometimes necessary to get direct access to the data underlying a value.  An example is a library call that takes a pointer to data.  KL itself has no notion of pointers; instead, KL has the concept of the <code class="code">Data</code> type whose value is a pointer to data which can be passed to an external library call.
      </p><p>
        Most values in KL have a built-in method called <code class="code">data</code> that returns a value of type <code class="code">Data</code>, and a built-in method called <code class="code">dataSize</code> that returns a value of type <code class="code">Size</code>.  The value returned by the <code class="code">data</code> method is a pointer to the data underlying the value, and the value returned by the <code class="code">dataSize</code> method is the number of bytes the value occupies in memory.  The only values which do not support the <code class="code">data</code> and <code class="code">dataSize</code> methods are dictionaries as well as other derived types that do not lay out their elements or members contiguously in memory.
        
        </p><pre class="programlisting">
Integer integers[];
report(integers.data);  // OK: integers are contiguous in memory
String strings[];
report(strings.data);   // ERROR: string data is not contiguous in memory
        </pre><p>
      </p><p>
        Unlike pointers in C, the values returned by <code class="code">data</code> methods cannot be inspected or used in any expressions; the only thing which can be done is a cast to <code class="code">Boolean</code>, which will be <code class="code">true</code> if and only if the <code class="code">Data</code> value points to a value whose size is greater than zero.  However, these <code class="code">Data</code> values can be passed directly to external library functions provided by Fabric itself or Fabric extensions, where they are used as pointers to data in memory.
      </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
        For values of type <code class="code">String</code>, the value returned by <code class="code">dataSize</code> includes a null terminator that is automatically appended to the string by Fabric; this is so that the string data can be directly used in C library calls as a regular C string.  If you want to pass the number of characters in the string, pass <code class="code">string.length</code> instead.
      </p></td></tr></table></div><div class="example"><a name="types.data.ex"></a><p class="title"><b>Example&nbsp;3.11.&nbsp;<code class="code">Data</code> values and the <code class="code">data</code> and <code class="code">dataSize</code> methods</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  String s;
  report("s = '" + s + "'");
  report("s.data = " + s.data);
  report("Boolean(s.data) = " + Boolean(s.data));
  report("s.dataSize = " + s.dataSize);
  s = "Hello";
  report("s = '" + s + "'");
  report("s.data = " + s.data);
  report("Boolean(s.data) = " + Boolean(s.data));
  report("s.dataSize = " + s.dataSize);
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="types.data.ex.out"></a><p>Output:</p><pre class="screen">
s = ''
s.data = &lt;Opaque&gt;
Boolean(s.data) = false
s.dataSize = 1
s = 'Hello'
s.data = &lt;Opaque&gt;
Boolean(s.data) = true
s.dataSize = 6
      </pre></div></div></div><div class="chapter" title="Chapter&nbsp;4.&nbsp;Functions and Other Global Declarations"><div class="titlepage"><div><div><h2 class="title"><a name="globals"></a>Chapter&nbsp;4.&nbsp;Functions and Other Global Declarations</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#functions">Function Definitions</a></span></dt><dt><span class="section"><a href="#function-calls">Function Invocations</a></span></dt><dt><span class="section"><a href="#prototypes">Function Prototypes</a></span></dt><dt><span class="section"><a href="#built-in-functions">Built-in Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#built-in-functions.report">The <code class="code">report</code> Function</a></span></dt><dt><span class="section"><a href="#built-in-functions.numerical">Numerical Functions</a></span></dt></dl></dd><dt><span class="section"><a href="#polymorphism">Function Polymorphism</a></span></dt><dt><span class="section"><a href="#operators">Operators</a></span></dt><dt><span class="section"><a href="#constructors">Constructors</a></span></dt><dd><dl><dt><span class="section"><a href="#constructors.declaration">Constructor Declarations</a></span></dt><dt><span class="section"><a href="#constructors.invocation">Constructor Invocation</a></span></dt></dl></dd><dt><span class="section"><a href="#destructors">Destructors</a></span></dt><dt><span class="section"><a href="#methods">Methods</a></span></dt><dd><dl><dt><span class="section"><a href="#method-defs">Method Definitions</a></span></dt><dt><span class="section"><a href="#method-calls">Method Invocation</a></span></dt><dt><span class="section"><a href="#d5e1497">Methods Taking Read-Only or Read-Write Values for <code class="code">this</code></a></span></dt></dl></dd><dt><span class="section"><a href="#op-overloads">Overloaded Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#op-overloads.binop">Binary Operator Overloads</a></span></dt><dt><span class="section"><a href="#overloading-compound-ass-ops">Compound Assignment Overloads</a></span></dt></dl></dd><dt><span class="section"><a href="#global-constants">Global Constants</a></span></dt><dt><span class="section"><a href="#use">Importing Functionality With <code class="code">require</code></a></span></dt></dl></div><div class="section" title="Function Definitions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions"></a>Function Definitions</h2></div></div></div><p>
        Function definitions in KL are much the same as the <span class="quote">“<span class="quote">traditional</span>”</span> function definition syntax in JavaScript, with the following key differences:

        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The return type and the type of each function parameter must be explicitly declared.  If a function does not return a value, the return type must be omitted.</p></li><li class="listitem"><p>The parameter declarations may additionally declare the parameter as input (read-only; the default) by preceding the type by <code class="code">in</code> or input-output (read-write) by preceding the value by <code class="code">io</code>.</p></li></ul></div><p>
      </p><div class="example"><a name="functions.ex"></a><p class="title"><b>Example&nbsp;4.1.&nbsp;Function definitions</b></p><div class="example-contents"><pre class="programlisting">
// Function returning a value and using only
// input parameters

function Float32 add(Float32 lhs, Float32 rhs) {
  return lhs + rhs;
}

// Function not returning a value and using both
// input and input-output parameters

function add(in Float32 lhs, in Float32 rhs, io Float32 result) {
  result = lhs + rhs;
}
        </pre></div></div><br class="example-break"></div><div class="section" title="Function Invocations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="function-calls"></a>Function Invocations</h2></div></div></div><p>
        Function invocations (<span class="quote">“<span class="quote">calls</span>”</span>) are made using the same syntax as JavaScript, namely by appending a comma-delimited list of arguments, surrounded by parentheses, to the function name.
      </p><div class="example"><a name="functions.call.ex"></a><p class="title"><b>Example&nbsp;4.2.&nbsp;Function call</b></p><div class="example-contents"><pre class="programlisting">
function Integer add(Integer lhs, Integer rhs) {
  return lhs + rhs;
}

operator entry() {
  report("2 plus 2 is " + add(2, 2));
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="functions.call.ex.out"></a><p>Output:</p><pre class="screen">
2 plus 2 is 4
        </pre></div></div><div class="section" title="Function Prototypes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prototypes"></a>Function Prototypes</h2></div></div></div><p>
        A <em class="glossterm">function prototype</em> in KL is a function declaration that is missing a body.  Providing a function prototype allows the function to be called before it is defined.  This is useful under two circumstances:
        
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            When two or more functions call each other.  Such functions are sometimes referred to as <em class="glossterm">co-recursive</em>.
            
            </p><div class="example"><a name="prototypes.ex"></a><p class="title"><b>Example&nbsp;4.3.&nbsp;Co-recursion using a prototype</b></p><div class="example-contents"><pre class="programlisting">
// Function prototype for 'two', so that 'one' can call it before it is defined
function two(Integer n);

// The function 'one' calls 'two' even though it is not yet defined
function one(Integer n) {
  report("one");
  if (n &gt; 0)
    two(n - 1);
}

// The definition of the function 'two' comes after its prototype
function two(Integer n) {
  report("two");
  if (n &gt; 0)
    one(n - 1);
}

operator entry() {
  one(4);
}
              </pre></div></div><p><br class="example-break">
            </p><div class="informalfigure"><a name="prototypes.ex.out"></a><p>Output:</p><pre class="screen">
one
two
one
two
one
              </pre></div><p>
          </p></li><li class="listitem"><p>
            When a function definition is provided by a Fabric extension.  The name of the symbol of the function in the Fabric extension is provided by appending <code class="code">= "<em class="replaceable"><code>symbol name</code></em>"</code> or <code class="code">= '<em class="replaceable"><code>symbol name</code></em>'</code> to the function prototype.
            
            </p><div class="example"><a name="prototypes.external.ex"></a><p class="title"><b>Example&nbsp;4.4.&nbsp;External function</b></p><div class="example-contents"><pre class="programlisting">
// The prototype 'libc_perror' is linked to an external function 'perror'
function libc_perror(Data cString) = 'perror';

// The KL function 'perror' is what KL functions actually call
function perror(String string) {
  libc_perror(string.data);
}

operator entry() {
  perror("something that caused an error");
}
              </pre></div></div><p><br class="example-break">
          </p></li></ul></div><p>
      </p></div><div class="section" title="Built-in Functions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="built-in-functions"></a>Built-in Functions</h2></div></div></div><p>
        KL has several built-in functions that are available to all KL programs.
      </p><div class="section" title="The report Function"><div class="titlepage"><div><div><h3 class="title"><a name="built-in-functions.report"></a>The <code class="code">report</code> Function</h3></div></div></div><p>
          The <code class="code">report</code> function outputs a message to wherever messages are sent from KL; when KL is used from Fabric running in a browser this is to the JavaScript console, whereas when Fabric is used from the command line or when the KL tool is used the output is sent to standard error and standard output respectively.  A newline is appended to the message when it is sent.
        </p><p>
          The prototype of the <code class="code">report</code> function is:
          
          </p><pre class="programlisting">
function report(String message);
          </pre><p>
        </p><p>
          Within Fabric the report function is primarily used for debugging, whereas it is used for general output from the KL tool.
        </p></div><div class="section" title="Numerical Functions"><div class="titlepage"><div><div><h3 class="title"><a name="built-in-functions.numerical"></a>Numerical Functions</h3></div></div></div><p>
          KL has support for many of the <span class="quote">“<span class="quote">standard library</span>”</span> numerical functions from C.  Each of these functions has a version that takes a parameter or parameters of type <code class="code">Float32</code>, and another that takes a parameter or parameters of type <code class="code">Float64</code>.  The one that is called is chosen using polymorphism best-match rules; see <a class="xref" href="#polymorphism" title="Function Polymorphism">the section called “Function Polymorphism”</a>.
        </p><div class="section" title="Trigonometric Functions"><div class="titlepage"><div><div><h4 class="title"><a name="built-in-functions.numerical.trig"></a>Trigonometric Functions</h4></div></div></div><div class="variablelist"><dl><dt><a name="built-in-functions.numerical.trig.sin"></a><span class="term"><code class="code">sin(x)</code></span></dt><dd>Returns the sine of the argument <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.trig.cos"></a><span class="term"><code class="code">cos(x)</code></span></dt><dd>Returns the cosine of the argument <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.trig.tan"></a><span class="term"><code class="code">tan(x)</code></span></dt><dd>Returns the tangent of the argument <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.trig.asin"></a><span class="term"><code class="code">asin(x)</code></span></dt><dd>Returns the arcsine of the argument <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.trig.acos"></a><span class="term"><code class="code">acos(x)</code></span></dt><dd>Returns the arccosine of the argument <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.trig.atan"></a><span class="term"><code class="code">atan(x)</code></span></dt><dd>Returns the arctangent of the argument <code class="code">x</code>.  <code class="code">atan(x)</code> doesn't work for large <code class="code">x</code> and can only return values in the range <span class="mathphrase">(-π/2,π/2]</span>; use the <code class="code">atan2</code> function instead when possible.</dd><dt><a name="built-in-functions.numerical.trig.atan2"></a><span class="term"><code class="code">atan2(y, x)</code></span></dt><dd><p>Returns the arctangent of the ratio <span class="mathphrase">y/x</span>; the result is in the range  <span class="mathphrase">(-π,π]</span>.</p></dd></dl></div></div><div class="section" title="Exponential and Logarithmic Functions"><div class="titlepage"><div><div><h4 class="title"><a name="built-in-functions.numerical.exp"></a>Exponential and Logarithmic Functions</h4></div></div></div><div class="variablelist"><dl><dt><a name="built-in-functions.numerical.exp.pow"></a><span class="term"><code class="code">pow(x, y)</code></span></dt><dd><p>Returns the value of <span class="mathphrase">x<sup>y</sup></span>.</p></dd><dt><a name="built-in-functions.numerical.exp.exp"></a><span class="term"><code class="code">exp(x)</code></span></dt><dd>Returns the value of <span class="mathphrase">e<sup>y</sup></span> where e is the base of the natural logarithm (2.7182818...).</dd><dt><a name="built-in-functions.numerical.exp.log"></a><span class="term"><code class="code">log(x)</code></span></dt><dd>Returns the natural logarithm of <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.exp.log10"></a><span class="term"><code class="code">log10(x)</code></span></dt><dd>Returns the common (base 10) logarithm of <code class="code">x</code>.</dd></dl></div></div><div class="section" title="Non-Transcendental Functions"><div class="titlepage"><div><div><h4 class="title"><a name="built-in-functions.numerical.nt"></a>Non-Transcendental Functions</h4></div></div></div><div class="variablelist"><dl><dt><a name="built-in-functions.numerical.nt.abs"></a><span class="term"><code class="code">abs(x)</code></span></dt><dd><p>Returns the absolute value of <code class="code">x</code>.</p></dd><dt><a name="built-in-functions.numerical.nt.round"></a><span class="term"><code class="code">round(x)</code></span></dt><dd>Returns the value of <code class="code">x</code> rounded to the nearest whole (fractional part of zero) floating-point number.</dd><dt><a name="built-in-functions.numerical.nt.floor"></a><span class="term"><code class="code">floor(x)</code></span></dt><dd>Returns the greatest whole floating-point number less than or equal to <code class="code">x</code>.</dd><dt><a name="built-in-functions.numerical.nt.ceil"></a><span class="term"><code class="code">ceil(x)</code></span></dt><dd>Returns the smallest whole floating-point number greater than or equal to <code class="code">x</code>.</dd></dl></div></div></div></div><div class="section" title="Function Polymorphism"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="polymorphism"></a>Function Polymorphism</h2></div></div></div><p>
        KL support <em class="glossterm">compile-type function polymorphism</em>.  This means that you can have multiple functions with the same name so long as they have a different number of parameters or those parameters differ by type and/or their input versus input-output qualification.

        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It is an error to have two functions with the same name that take exactly the same parameter types but return different types</p></td></tr></table></div><p>
      </p><p>
        When a function call is made in KL source, if there are multiple functions with the same name then the KL compiler uses a best-match system to determine which function to call.  Exact parameter type matches are always prioritized over type casts.  If the compiler is unable to choose a unique best match then an error will be reported showing the ambiguity.
      </p><div class="example"><a name="polymorphism.ex"></a><p class="title"><b>Example&nbsp;4.5.&nbsp;Function polymorphism</b></p><div class="example-contents"><pre class="programlisting">
function display(Integer a) {
  report("integer value is " + a);
}

function display(String s) {
  report("string value is '" + s + "'");
}

operator entry() {
  Integer integer = 42;
  display(integer);
  
  String string = "hello";
  display(string);
  
  Byte byte = 64;
  display(byte);
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="polymorphism.ex.out"></a><p>Output:</p><pre class="screen">
integer value is 42
string value is 'hello'
integer value is 64
        </pre></div></div><div class="section" title="Operators"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="operators"></a>Operators</h2></div></div></div><p>
        The <code class="code">operator</code> keyword in KL is used to mark functions that are to be used as entry points into KL from the Fabric dependency graph.  Operators are declared in the same way as functions except that they must not return a value.  Fabric does special type-checking to ensure that operators are bound properly to nodes in a Fabric dependency graph.
      </p><div class="example"><a name="operators.ex"></a><p class="title"><b>Example&nbsp;4.6.&nbsp;Operator definition</b></p><div class="example-contents"><pre class="programlisting">
operator addElements(io Float32 lhs, io Float32 rhs, io Float32 result) {
  result = lhs + rhs;
}
        </pre></div></div><br class="example-break"></div><div class="section" title="Constructors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="constructors"></a>Constructors</h2></div></div></div><p>
        A <em class="glossterm">constructor</em> for a user-defined type is a function that initializes a value with the given the type from other values.
      </p><div class="section" title="Constructor Declarations"><div class="titlepage"><div><div><h3 class="title"><a name="constructors.declaration"></a>Constructor Declarations</h3></div></div></div><p>
          A constructor is declared as a function whose name is the name of the user-defined type.  The function can take any number of parameters, all of which must be input parameters; constructors cannot take input-output parameters.  Constructors cannot return values.
        </p><p>
          Within the body of a constructor definition, the value being initialized is referred to with the <code class="code">this</code> keyword; its members are accessed using the <code class="code">.</code> operator.  In this context, <code class="code">this</code> is always read-write, ie. its members can be modified.
        </p><div class="example"><a name="constructors.declaration.ex"></a><p class="title"><b>Example&nbsp;4.7.&nbsp;Constructor declarations</b></p><div class="example-contents"><pre class="programlisting">
struct Complex32 {
  Float32 re;
  Float32 im;
};

// The empty constructor; 
function Complex32() {
  this.re = this.im = 0.0;
}

// Construct a Complex from a Float32
function Complex32(Float32 x) {
  this.re = x;
  this.im = 0.0;
}

// Construct a Complex from two Float32s
function Complex32(Float32 x, Float32 y) {
  this.re = x;
  this.im = y;
}

operator entry() {
  report(Complex32());
  report(Complex32(3.141));
  report(Complex32(3.141, 2.718));
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><a name="constructors.declaration.ex.out"></a><p>Output:</p><pre class="screen">
{re:0,im:0}
{re:3.141,im:0}
{re:3.141,im:2.718}
          </pre></div></div><div class="section" title="Constructor Invocation"><div class="titlepage"><div><div><h3 class="title"><a name="constructors.invocation"></a>Constructor Invocation</h3></div></div></div><p>
          Constructors are invoked in one of several ways:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a name="constructors.invocation.naked"></a>
                If a variable is declared without any initialization, the <em class="glossterm">empty constructor</em> (ie. the constructor that takes no parameters) is invoked to initialize the variable.  This is referred to as <em class="glossterm">naked initialization</em>.
              
                </p><div class="example"><a name="constructors.invocation.naked.ex"></a><p class="title"><b>Example&nbsp;4.8.&nbsp;Constructor invocation using naked initialization</b></p><div class="example-contents"><pre class="programlisting">
  struct MyType {
    Integer n;
    Float32 x;
  };

  // The empty constructor
  function MyType() {
    this.n = 42;
    this.x = 3.141;
  }

  operator entry() {
    MyType myType; // invokes the empty constructor
    report(myType);
  }
                  </pre></div></div><p><br class="example-break">
                </p><div class="informalfigure"><a name="constructors.invocation.naked.ex.out"></a><p>Output:</p><pre class="screen">
  {n:42,x:3.141}
                  </pre></div><p>
              </p></li><li class="listitem"><p><a name="constructors.invocation.assignment"></a>
                If a variable is assigned to as part of its declaration, a single-parameter constructor is invoked.  This is referred to as <em class="glossterm">assignment initialization</em>.  If there isn't an exact match for the type of the value assigned, best-match polymorphism rules are used to choose the constructor to invoke.
              
                </p><div class="example"><a name="constructors.invocation.assignment.ex"></a><p class="title"><b>Example&nbsp;4.9.&nbsp;Constructor invocation using assignment initialization</b></p><div class="example-contents"><pre class="programlisting">
  struct MyType {
    String string;
  };

  // Construct from a string
  function MyType(String string) {
    this.string = "The string was '" + string + "'";
  }

  // Construct from a scalar
  function MyType(Float64 float64) {
    this.string = "The float64 was " + float64;
  }

  operator entry() {
    // Construct MyType from String value
    MyType myTypeFromString = "foo";
    report(myTypeFromString);
  
    // Construct MyType from Float64 value
    MyType myTypeFromFloat64 = 2.718;
    report(myTypeFromFloat64);
  
    // There is no constructor that takes a Boolean but
    // there is a cast from Boolean to String
    MyType myTypeFromBoolean = true;
    report(myTypeFromBoolean);
  }
                  </pre></div></div><p><br class="example-break">
                </p><div class="informalfigure"><a name="constructors.invocation.assignment.ex.out"></a><p>Output:</p><pre class="screen">
  {string:"The string was 'foo'"}
  {string:"The float64 was 2.718"}
  {string:"The string was 'true'"}
                  </pre></div><p>
              </p></li><li class="listitem"><p><a name="constructors.invocation.call"></a>
                If a variable is <span class="quote">“<span class="quote">called</span>”</span> (ie. using function call syntax) as part of its declaration, the constructor taking the given arguments is invoked.  This is referred to as <em class="glossterm">invocation initialization</em>.  If there isn't an exact match for the arguments passed to the call, best-match polymorphism rules are used to choose the constructor to invoke.
              
                </p><div class="example"><a name="constructors.invocation.call.ex"></a><p class="title"><b>Example&nbsp;4.10.&nbsp;Constructor invocation using invocation initialization</b></p><div class="example-contents"><pre class="programlisting">
  struct Vec2 {
    Float64 x;
    Float64 y;
  };

  // Construct from two scalars
  function Vec2(Float64 x, Float64 y) {
    this.x = x;
    this.y = y;
  }

  operator entry() {
    Vec2 vec2FromFloat64s(3.141, 2.718);
    report(vec2FromFloat64s);
    Vec2 vec2FromIntegers(42, -7);  // Uses best-match polymorphism to convert Integer to Float64
    report(vec2FromIntegers);
  }
                  </pre></div></div><p><br class="example-break">
                </p><div class="informalfigure"><a name="constructors.invocation.call.ex.out"></a><p>Output:</p><pre class="screen">
  {x:3.141,y:2.718}
  {x:42,y:-7}
                  </pre></div><p>
              </p></li><li class="listitem"><p><a name="constructors.invocation.temp"></a>
                If a function call is performed where the name of the function is the name of the type, the constructor taking the given arguments is invoked to create a temporary value of the named type.  If there isn't an exact match for the arguments passed to the call, best-match polymorphism rules are used to choose the constructor to invoke.
              
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>KL does not distinguish between construction and casting.  Casting a value to a different type is the same as constructing a temporary value of the given type and initializing it, using the appropriate constructor, from the given value.</p></td></tr></table></div><p>
              
                </p><div class="example"><a name="constructors.invocation.temp.ex"></a><p class="title"><b>Example&nbsp;4.11.&nbsp;Constructor invocation using temporary value</b></p><div class="example-contents"><pre class="programlisting">
struct Vec2 {
  Float64 x;
  Float64 y;
};

// Construct from two scalars
function Vec2(Float64 x, Float64 y) {
  this.x = x;
  this.y = y;
}

operator entry() {
  report(Vec2(3.141, 2.718));
  report(Vec2(42, -7));  // Uses best-match polymorphism to convert Integer to Float64
}
                  </pre></div></div><p><br class="example-break">
                </p><div class="informalfigure"><a name="constructors.invocation.temp.ex.out"></a><p>Output:</p><pre class="screen">
{x:3.141,y:2.718}
{x:42,y:-7}
                  </pre></div><p>
              </p></li></ul></div><p>
        </p></div></div><div class="section" title="Destructors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="destructors"></a>Destructors</h2></div></div></div><p>
        A destructor is a function that is called when a variable goes out of scope and its resources are freed.  Destructors are declared by prepending <code class="code">~</code> in front of the name of the type and using it as a function.  Destructors cannot take any parameters or return values.  The destructor is called before the value is freed so that its members are still accessible.  In the body of the destructor the value is referred to using the <code class="code">this</code> keyword; the value is input-ouput, ie. it can be modified in the destructor.
      </p><div class="example"><a name="destructors.ex"></a><p class="title"><b>Example&nbsp;4.12.&nbsp;Destructor</b></p><div class="example-contents"><pre class="programlisting">
struct MyType {
  String s;
};

// Empty constructor
function MyType() {
  this.s = "foo";
  report("Creating MyType: this.s = " + this.s);
}

// Destructor
function ~MyType() {
  report("Destroying MyType: this.s = " + this.s);
}

operator entry() {
  MyType myType;
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="destructors.ex.out"></a><p>Output:</p><pre class="screen">
Creating MyType: this.s = foo
Destroying MyType: this.s = foo
        </pre></div></div><div class="section" title="Methods"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="methods"></a>Methods</h2></div></div></div><p>
        A <em class="glossterm">method</em> is a function that operates on a user-defined structure.  It uses a slightly different (and more suggestive) syntax than plain function calls for the case that the function call is strongly tied to a value whose type is a user-defined structure.
      </p><div class="section" title="Method Definitions"><div class="titlepage"><div><div><h3 class="title"><a name="method-defs"></a>Method Definitions</h3></div></div></div><p>
          If <code class="code"><em class="replaceable"><code>Type</code></em></code> is a structure or alias, then a method named <code class="code"><em class="replaceable"><code>methodName</code></em></code> can be added to the type using the following syntax:
        
          </p><pre class="programlisting">
// A method that returns a value
function <em class="replaceable"><code>ReturnType</code></em> <em class="replaceable"><code>Type</code></em>.<em class="replaceable"><code>methodName</code></em>(<em class="replaceable"><code>parameter list</code></em>) {
  <em class="replaceable"><code>method body</code></em>
}

// A method that does not return a value
function <em class="replaceable"><code>Type</code></em>.<em class="replaceable"><code>methodName</code></em>(<em class="replaceable"><code>parameter list</code></em>) {
  <em class="replaceable"><code>method body</code></em>
}
          </pre><p>
        
          Within the method body, <code class="code">this</code> refers to the value on which the method is called.  <code class="code">this</code> is read-only if the method returns a value and is read-write if the method does not return a value.
        </p></div><div class="section" title="Method Invocation"><div class="titlepage"><div><div><h3 class="title"><a name="method-calls"></a>Method Invocation</h3></div></div></div><p>
          If <code class="code"><em class="replaceable"><code>value</code></em></code> is a value of type <code class="code"><em class="replaceable"><code>Type</code></em></code> then the method <code class="code"><em class="replaceable"><code>methodName</code></em></code> can be invoked on <code class="code"><em class="replaceable"><code>value</code></em></code> using the expression <code class="code"><em class="replaceable"><code>value</code></em>.<em class="replaceable"><code>methodName</code></em>(<em class="replaceable"><code>argument list</code></em>)</code>.  If a method takes no parameters, then it is optional to use parentheses when calling it.
        </p><p>
          Just as there can be multiple functions with the same name, a given type can have multiple methods with the same name.  When deciding which method to invoke, the usual best-match rules apply.
        </p><div class="example"><a name="methods.ex"></a><p class="title"><b>Example&nbsp;4.13.&nbsp;Method definition and invocation</b></p><div class="example-contents"><pre class="programlisting">
struct Type {
  Integer a;
  Float32 b;
};

// Add method desc to Type
function String Type.desc() {
  return "a:" + this.a + "; b:" + this.b;
}

operator entry() {
  Type t;
  t.a = 1;
  t.b = 3.14;
  // Both report 'a:1; b:3.14'
  report(t.desc());
  report(t.desc);
}
          </pre><p>Output:</p><pre class="screen">
a:1; b:3.14
a:1; b:3.14
          </pre></div></div><br class="example-break"></div><div class="section" title="Methods Taking Read-Only or Read-Write Values for this"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1497"></a>Methods Taking Read-Only or Read-Write Values for <code class="code">this</code></h3></div></div></div><p>
          Whether <code class="code">this</code> is read-only or read-write (in compiler terms, an r-value or an l-value) can be controlled on a per-method basis.  By default, <code class="code">this</code> is read-only when the method returns a value and read-write when the method does not return a value.  This can be controlled by suffixing the method name with <code class="code">!</code> (exclamation mark) to force <code class="code">this</code> to be read-write or <code class="code">?</code> (question mark) to force <code class="code">this</code> to be read-only.
        </p><div class="example"><a name="d5e1507"></a><p class="title"><b>Example&nbsp;4.14.&nbsp;Explicit read-only or read-write <code class="code">this</code> in methods</b></p><div class="example-contents"><pre class="programlisting">
struct Vec2 {
  Float64 x;
  Float64 y;
};

function Vec2(in Float64 x, in Float64 y) {
  this.x = x;
  this.y = y;
}

// Explicitly make 'this' read-only
function Vec2.getComponents?(io Float64 x, io Float64 y) {
  x = this.x;
  y = this.y;
}

function Float64 Vec2.normSq() {
  return this.x*this.x + this.y*this.y;
}

function Float64 Vec2.norm() {
  return sqrt(this.normSq());
}

function Vec2./=(in Float64 value) {
  this.x /= value;
  this.y /= value;
}

// Explicitly make 'this' read-write
function Float64 Vec2.normalizeAndReturnOldNorm!() {
  Float64 oldNorm = this.norm();
  this /= oldNorm;
  return oldNorm;
}

operator entry() {
  Vec2 vec2(3.14, 2.71);

  Float64 x, y;
  vec2.getComponents(x, y);
  report("vec2.getComponents: x=" + x + ", y=" + y);

  report("vec2.normalizeAndReturnOldNorm returned " + vec2.normalizeAndReturnOldNorm());
  report("vec2 is now " + vec2);
}
          </pre><p>Output:</p><pre class="screen">
vec2.getComponents: x=3.14, y=2.71
vec2.normalizeAndReturnOldNorm returned 4.147734321289154
vec2 is now {x:0.7570398093926274,y:0.6533687526923632}
          </pre></div></div><br class="example-break"></div></div><div class="section" title="Overloaded Operators"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="op-overloads"></a>Overloaded Operators</h2></div></div></div><p>
        KL allows overloading of binary operators and compound assignment operators for custom types (ie. specified through <code class="code">struct</code>).
      </p><div class="section" title="Binary Operator Overloads"><div class="titlepage"><div><div><h3 class="title"><a name="op-overloads.binop"></a>Binary Operator Overloads</h3></div></div></div><p>
          Binary operators can be overloaded using the following syntax:
      
          </p><div class="example"><a name="op-overloads.binop.ex"></a><p class="title"><b>Example&nbsp;4.15.&nbsp;Binary operator overload</b></p><div class="example-contents"><pre class="programlisting">
struct Type {
  Integer a;
  Float32 b;
};

function Type +(Type lhs, Type rhs) {
  Type result;
  result.a = lhs.a + rhs.a;
  result.b = lhs.b + rhs.b;
  return result;
}

operator entry() {
  Type t1; t1.a = 42; t1.b = 3.14; report(t1);
  Type t2; t2.a = 7; t2.b = 2.72; report(t2);
  Type t3 = t1 + t2; report(t3);
}
            </pre></div></div><p><br class="example-break">
          </p><div class="informalfigure"><a name="op-overloads.binop.ex.out"></a><p>Output:</p><pre class="screen">
{a:42,b:3.14}
{a:7,b:2.72}
{a:49,b:5.86}
            </pre></div><p>

          Any of the binary arithmetic (<code class="code">+</code>, <code class="code">-</code>, <code class="code">*</code>, <code class="code">/</code> and <code class="code">%</code>), bitwise (<code class="code">|</code>, <code class="code">&amp;</code>, <code class="code">^</code>, <code class="code">&lt;&lt;</code> and <code class="code">&gt;&gt;</code>) and comparison (<code class="code">==</code>, <code class="code">!=</code>, <code class="code">&lt;</code>, <code class="code">&lt;=</code>, <code class="code">&gt;</code> and <code class="code">&gt;=</code>) operators can be overloaded.
        </p><p>
          Binary operator overloads are subject to the following restrictions:
        
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">They must take exactly two parameters.  The two parameters may be of any type and the two types may be different but they must both be input-only parameters.</li><li class="listitem">They must return a value.  However, the return type can be any type.</li></ul></div><p>
        </p></div><div class="section" title="Compound Assignment Overloads"><div class="titlepage"><div><div><h3 class="title"><a name="overloading-compound-ass-ops"></a>Compound Assignment Overloads</h3></div></div></div><p>
          KL provides a default plain assignment for custom types which simply assigns each of the members.  It also provides a default <em class="glossterm">compound assignment</em> operator (ie. <code class="code">+=</code>, <code class="code">-=</code>, <code class="code">*=</code>, <code class="code">/=</code>, <code class="code">%=</code>, <code class="code">|=</code>, <code class="code">&amp;=</code>, <code class="code">^=</code>, <code class="code">&lt;&lt;=</code> and <code class="code">&gt;&gt;=</code>) by composing the associated binary operator, if available, with an assignment.
        </p><p>
          However, it is also possible to provide an overload for any of the compound assignment operators using the following syntax:

          </p><div class="example"><a name="op-overloads.assop.ex"></a><p class="title"><b>Example&nbsp;4.16.&nbsp;Compound assignment overload</b></p><div class="example-contents"><pre class="programlisting">
struct Type {
  Integer a;
  Float32 b;
};

function Type.+=(Type that) {
  this.a += that.a;
  this.b += that.b;
}

operator entry() {
  Type t1; t1.a = 42; t1.b = 3.14; report("t1 is " + t1);
  Type t2; t2.a = 7; t2.b = 2.72; report("t2 is " + t2);
  t1 += t2; report("t1 is now " + t1);
}
            </pre></div></div><p><br class="example-break">
          </p><div class="informalfigure"><a name="op-overloads.assop.ex.out"></a><p>Output:</p><pre class="screen">
t1 is {a:42,b:3.14}
t2 is {a:7,b:2.72}
t1 is now {a:49,b:5.86}
            </pre></div><p>
        </p><p>
          Compound assignment overloads are subject to the following restrictions:
        
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">They must take exactly one parameter.  The parameter may be of any type but it must be an input-only parameter.</li><li class="listitem">They must not return a value.</li></ul></div><p>
        </p></div></div><div class="section" title="Global Constants"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="global-constants"></a>Global Constants</h2></div></div></div><p>
        A <em class="glossterm">global constant</em> in KL is a global declaration of the form:
      
        </p><pre class="programlisting">const <em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>name</code></em> = <em class="replaceable"><code>value</code></em>;</pre><p>
      
        <code class="code"><em class="replaceable"><code>Type</code></em></code> must be an integer or floating-point type; <code class="code"><em class="replaceable"><code>name</code></em></code> must be an identifier; and <code class="code"><em class="replaceable"><code>value</code></em></code> must be constant of the appropriate type.
      </p><p>
        It is a compile-time error to try to do any of the following:
        
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>assign to a global constant</p></li><li class="listitem"><p>pass a global constant to a function as an input-output parameter</p></li><li class="listitem"><p>declare a global constant with the same name as a function, operator or another global constant</p></li></ul></div><p>
      </p><div class="example"><a name="global-constants.ex"></a><p class="title"><b>Example&nbsp;4.17.&nbsp;Global constants</b></p><div class="example-contents"><pre class="programlisting">
const Size twoToTheSixteen = 65536;
const Float64 pi = 3.14159365358979;

operator entry() {
  report("twoToTheSixteen = " + twoToTheSixteen);
  report("pi = " + pi);
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><a name="global-constants.ex.out"></a><p>Output:</p><pre class="screen">
twoToTheSixteen = 65536
pi = 3.14159365358979
        </pre></div></div><div class="section" title="Importing Functionality With require"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="use"></a>Importing Functionality With <code class="code">require</code></h2></div></div></div><p>
        Through integration with Fabric, it is possible for derived KL types and/or Fabric extensions to provide KL code that is defined externally to the current source file.  To use these types and code within the current source file, the <code class="code">require</code> statement is provided; it is similar to the <code class="code">import</code> statement in Python.
      </p><p>
        The <code class="code">require</code> statement should be followed by the name of the registered type or extension.  For example, to include the functionality provided by the extension named <span class="quote">“<span class="quote">Math</span>”</span> and the registered type named <span class="quote">“<span class="quote">RegType</span>”</span>, the program should start with:
        
        </p><pre class="programlisting">
require Math, RegType;
        </pre><p>
        
        Any <code class="code">require</code> statements must appear at the top of the KL program that uses the associated functionality.  You can have as many <code class="code">require</code> statements as you would like.
      </p></div></div><div class="chapter" title="Chapter&nbsp;5.&nbsp;Operators and Expressions"><div class="titlepage"><div><div><h2 class="title"><a name="ops-exprs"></a>Chapter&nbsp;5.&nbsp;Operators and Expressions</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ops">Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#arithmetic-ops">Arithmetic Operators</a></span></dt><dt><span class="section"><a href="#logical-ops">Logical Operators</a></span></dt><dt><span class="section"><a href="#bitwise-ops">Bitwise Operators</a></span></dt><dt><span class="section"><a href="#ass-ops">Assignment Operators</a></span></dt><dt><span class="section"><a href="#ops-and-polymorphism">Operators and Polymorphism</a></span></dt></dl></dd><dt><span class="section"><a href="#exprs">Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#simple-exprs">Simple Expressions</a></span></dt><dt><span class="section"><a href="#compound-exprs">Compound Expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#order-of-ops">Controlling Order of Operations</a></span></dt><dt><span class="section"><a href="#scope">Scoping Rules</a></span></dt><dd><dl><dt><span class="section"><a href="#scope.types">Types of Scopes</a></span></dt><dt><span class="section"><a href="#scope.example">Nested Scopes Example</a></span></dt></dl></dd></dl></div><p>
      This chapter explains the possible operators and resulting expressions in KL.  Generally, KL has the same operator and expression syntax as JavaScript and C, and in particular follows exactly the same precedence and associativity rules.
    </p><div class="section" title="Operators"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ops"></a>Operators</h2></div></div></div><p>
        KL supports the same basic set of operators as JavaScript and C.  These operations are broadly categorized as <a class="link" href="#arithmetic-ops" title="Arithmetic Operators">arithmetic operators</a>, <a class="link" href="#logical-ops" title="Logical Operators">logical operators</a>, <a class="link" href="#bitwise-ops" title="Bitwise Operators">bitwise operators</a> and <a class="link" href="#ass-ops" title="Assignment Operators">assignment operators</a>.
      </p><div class="section" title="Arithmetic Operators"><div class="titlepage"><div><div><h3 class="title"><a name="arithmetic-ops"></a>Arithmetic Operators</h3></div></div></div><div class="section" title="Add and Subtract"><div class="titlepage"><div><div><h4 class="title"><a name="add-ops"></a>Add and Subtract</h4></div></div></div><p>
            When <code class="code">+</code> or <code class="code">-</code> appear between two expressions they are referred to as the <em class="glossterm">add</em> and <em class="glossterm">subtract</em> binary operators.  These operators are pre-defined for all integer and floating point types, where they perform the usual arithmetic operations, but they can also be overloaded to apply to user-defined structures or different combinations of types.  For example, it is possible to define an operator that takes a user-defined <code class="code">Rect</code> on the left and a user-defined <code class="code">Point</code> on the right.
          </p><p>
            In addition to being pre-defined for integer and floating-point types, the <code class="code">+</code> (add) operator (but not the <code class="code">-</code> [subtract] operator) is defined for the <code class="code">String</code> type; the result of adding two strings is the two strings concatenated together.
          </p></div><div class="section" title="Multiply, Divide and Remainder"><div class="titlepage"><div><div><h4 class="title"><a name="mul-ops"></a>Multiply, Divide and Remainder</h4></div></div></div><p>
            When <code class="code">*</code>, <code class="code">/</code> or <code class="code">%</code> appear between two expressions they are referred to as the <em class="glossterm">multiply</em>, <em class="glossterm">divide</em> and <em class="glossterm">remainder</em> binary operators.  These operators are pre-defined for all integer and floating point types, where they perform the usual arithmetic operations, but they can also be overloaded to apply to user-defined structures or different combinations of types.  For example, it is possible to define a multiply operator that takes a <code class="code">Float32</code> on the left and a user-defined <code class="code">Vec3</code> on the right.
          </p></div><div class="section" title="Unary Plus and Minus"><div class="titlepage"><div><div><h4 class="title"><a name="unary-plus-minus-ops"></a>Unary Plus and Minus</h4></div></div></div><p>
            When <code class="code">+</code> or <code class="code">-</code> appears in front of an integer or floating-point expression without an expression to the left they are referred to as the <em class="glossterm">unary plus</em> and <em class="glossterm">unary minus</em> operators.  The unary plus operator doesn't do anything to the value it operates on, but the unary minus operator returns the value that, when added to the original, produces zero (for unsigned integer expressions); for signed integer and floating-point expressions, this is value of the expression with its sign reversed.
          </p><p>
            It is currently not possible to overload the unary plus and minus operators; this will be fixed in a future version of Fabric.
          </p></div><div class="section" title="Increment and Decrement Operators"><div class="titlepage"><div><div><h4 class="title"><a name="inc-dec-ops"></a>Increment and Decrement Operators</h4></div></div></div><p>
            The <code class="code">++</code> (increment) and <code class="code">--</code> (decrement) operators can be used to add one to or subtract one from a variable.  These operators have the following properties:
        
            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                The operators only work on variables or input-output parameters; then cannot operate on constants or input parameters.  This is because they change the value of the expression.
              </p></li><li class="listitem"><p>
                They only operate on integer values.
              </p></li><li class="listitem"><p>
                Each operator can appear either <span class="emphasis"><em>precede</em></span> or <span class="emphasis"><em>follow</em></span> the variable it operates on.  When it precedes the variable, the value of the expression is the value of the variable <span class="emphasis"><em>after</em></span> incrementing; this is referred to as a <span class="emphasis"><em>prefix</em></span> increment (or decrement).  When it follows the variable, the result is the value of the variable <span class="emphasis"><em>before</em></span> incrementing; this is referred to as a <span class="emphasis"><em>postfix</em></span> increment (or decrement).
              </p></li><li class="listitem"><p>
                They cannot be overloaded.
              </p></li></ul></div><p>
          </p></div></div><div class="section" title="Logical Operators"><div class="titlepage"><div><div><h3 class="title"><a name="logical-ops"></a>Logical Operators</h3></div></div></div><div class="section" title="Equality Operators"><div class="titlepage"><div><div><h4 class="title"><a name="eq-ops"></a>Equality Operators</h4></div></div></div><p>
            When <code class="code">==</code> or <code class="code">!=</code> appear between two expressions they are referred to as the <em class="glossterm">equal-to</em> or <em class="glossterm">not-equal-to</em> binary operators, respectively; collectively, they are referred to as the <em class="glossterm">equality operators</em>.
          </p><p>
            The equality operators are pre-defined for all integer and floating-point types as well as the <code class="code">Boolean</code> and <code class="code">String</code> types.  They can also be overloaded to apply to user-defined structure types or combinations of different types.
          </p></div><div class="section" title="Relational Operators"><div class="titlepage"><div><div><h4 class="title"><a name="rel-ops"></a>Relational Operators</h4></div></div></div><p>
            When <code class="code">&lt;</code>, <code class="code">&lt;=</code>, <code class="code">&gt;</code> or <code class="code">&gt;=</code> appear between two expressions they are referred to as the <em class="glossterm">less-than</em>, <em class="glossterm">less-than-or-equal-to</em>, <em class="glossterm">greater-than</em> or <em class="glossterm">greater-than-or-equal-to</em> binary operators, respectively; collectively, they are referred to as the <em class="glossterm">relational operators</em>.
          </p><p>
            The relational operators are pre-defined for all integer and floating-point types as well as the <code class="code">String</code> type.  They can also be overloaded to apply to user-defined structure types or combinations of different types.
          </p></div><div class="section" title="Logical AND"><div class="titlepage"><div><div><h4 class="title"><a name="log-and-op"></a>Logical AND</h4></div></div></div><p>
            When <code class="code">&amp;&amp;</code> appears between two expressions it is referred to as the <em class="glossterm">logical AND</em> binary operator.  Logical AND operates as follows: the left operand is cast to a <code class="code">Boolean</code> (ie. a <code class="code">Boolean</code> value is constructed from the left hand operand).  If the result is <code class="code">true</code>, the result is the right operand, otherwise the result is the left operand.
          </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>
              The behaviour of logical AND is the same as in JavaScript but different than C.  In C, the result value of a logical AND is always an integer (bool in C++).
            </p></td></tr></table></div><p>
            It is not possible to overload the logical AND operator.  However, you can <span class="quote">“<span class="quote">enable</span>”</span> it for custom types (structures) by creating a <code class="code">Boolean</code> constructor with a single parameter whose type is the type of the left operand.
          </p></div><div class="section" title="Logical OR"><div class="titlepage"><div><div><h4 class="title"><a name="log-or-op"></a>Logical OR</h4></div></div></div><p>
            When <code class="code">||</code> appears between two expressions it is referred to as the <em class="glossterm">logical OR</em> binary operator.  Logical OR operates as follows: the left operand is cast to a <code class="code">Boolean</code> (ie. a <code class="code">Boolean</code> value is constructed from the left hand operand).  If the result is <code class="code">true</code>, the result is the left operand, otherwise the result is the right operand.
          </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>
              The behaviour of logical OR is the same as in JavaScript but different than C.  In C, the result value of a logical AND is always an integer (bool in C++).
            </p></td></tr></table></div><p>
            It is not possible to overload the logical OR operator.  However, you can <span class="quote">“<span class="quote">enable</span>”</span> it for custom types (structures) by creating a <code class="code">Boolean</code> constructor with a single parameter whose type is the type of the left operand.
          </p></div><div class="section" title="Logical NOT"><div class="titlepage"><div><div><h4 class="title"><a name="logical-not"></a>Logical NOT</h4></div></div></div><p>
            When <code class="code">!</code> (exclamation mark) appears in front of an expression it is referred to as the <em class="glossterm">logical NOT</em> unary operator.  Logical NOT inverts the logical value of expression; more specifically, it constructs a new <code class="code">Boolean</code> value from the expression and then inverts its logical value.  Therefore, logical not can be applied to any expression that has a <code class="code">Boolean</code> constructor that takes a single parameter whose types is the type of the expression.
          </p><p>
            It is not possible to overload the logical NOT operator.  However, you can <span class="quote">“<span class="quote">enable</span>”</span> it for custom types (structures) by creating a <code class="code">Boolean</code> constructor with a single parameter whose type is the structure.
          </p></div><div class="section" title="The Conditional Operator"><div class="titlepage"><div><div><h4 class="title"><a name="cond-op"></a>The Conditional Operator</h4></div></div></div><p>
            When three expressions are separated by <code class="code">?</code> and <code class="code">:</code> it is referred to as the <em class="glossterm">conditional operator</em> (or <em class="glossterm">ternary operator</em>).  The conditional operator constructs a <code class="code">Boolean</code> from the first operand; if it has value <code class="code">true</code>, the result is the second operand, otherwise it is the third.
          </p><p>
            It is not possible to overload the conditional operator.
          </p></div></div><div class="section" title="Bitwise Operators"><div class="titlepage"><div><div><h3 class="title"><a name="bitwise-ops"></a>Bitwise Operators</h3></div></div></div><div class="section" title="Bitwise AND, OR and XOR"><div class="titlepage"><div><div><h4 class="title"><a name="bit-bin-ops"></a>Bitwise AND, OR and XOR</h4></div></div></div><p>
            When <code class="code">&amp;</code>, <code class="code">|</code> or <code class="code">^</code> appear between two expressions they are referred to as <em class="glossterm">bitwise AND</em>, <em class="glossterm">bitwise OR</em> or <em class="glossterm">bitwise XOR</em> binary operators, respectively.
          </p><p>
            Bitwise AND, OR and XOR are predefined for all integer types; they perform the usual bitwise operation on the two values.  They are also predefined for the <code class="code">Boolean</code> type, which is treated as if it was a single bit with value 1 (if true) or 0 (if false).
          </p><p>
            Bitwise AND, OR and XOR can be overloaded for user-defined structures or combinations of different types.
          </p></div><div class="section" title="Bitwise NOT"><div class="titlepage"><div><div><h4 class="title"><a name="bitwise-not"></a>Bitwise NOT</h4></div></div></div><p>
            When <code class="code">~</code> (tilde) appears in front of an expression it is referred to as the <em class="glossterm">bitwise NOT</em> unary operator.
          </p><p>
            Bitwise NOT is predefined for all integer types; it inverts the state of the bits of the value.  It is also predefined for the <code class="code">Boolean</code> type, which is treated as if it was a single bit with value 1 (if true) or 0 (if false).
          </p><p>
            It is not currently possible to overload the bitwise NOT operator; this will change in a future version of Fabric.
          </p></div><div class="section" title="Left and Right Shift"><div class="titlepage"><div><div><h4 class="title"><a name="shift-ops"></a>Left and Right Shift</h4></div></div></div><p>
            When <code class="code">&lt;&lt;</code> or <code class="code">&gt;&gt;</code> appear between two expressions they are referred to as the <em class="glossterm">left shift</em> or <em class="glossterm">right shift</em> binary operators, respectively.  These operators are pre-defined for all integer types, where they perform a left or right bit shift of the left operand by the number of bits given in the right operand.
          </p><p>
            A right-shift of a signed integer value will fill the left most bits with the sign bit, not with zeros.  Right shifts of unsigned integer values and left shifts of any integer values always fill with zeros.
          </p><p>
            It is possible to overload the shift operators for user-defined types, and even provide non-integer types as right-hand operands.
          </p></div></div><div class="section" title="Assignment Operators"><div class="titlepage"><div><div><h3 class="title"><a name="ass-ops"></a>Assignment Operators</h3></div></div></div><div class="section" title="Direct Assignment Operator"><div class="titlepage"><div><div><h4 class="title"><a name="direct-ass-op"></a>Direct Assignment Operator</h4></div></div></div><p>
            When <code class="code">=</code> appears between two expressions it is referred to as the <em class="glossterm">direct assignment operator</em>.  The direct assignment operator is predefined for all types; see <a class="xref" href="#types" title="Chapter&nbsp;3.&nbsp;The KL Type System">Chapter&nbsp;3, <i>The KL Type System</i></a> for details on how direct assignment operates for a given type.
          </p></div><div class="section" title="Compound Assignment Operators"><div class="titlepage"><div><div><h4 class="title"><a name="compound-ass-ops"></a>Compound Assignment Operators</h4></div></div></div><p>
            Any of the arithmetic or bitwise (but not logical) binary operators can be combined with <code class="code">=</code> to form a <em class="glossterm">compound assignment operator</em>; these are specifically <code class="code">+=</code>, <code class="code">-=</code>, <code class="code">*=</code>, <code class="code">/=</code>, <code class="code">%=</code>, <code class="code">&lt;&lt;=</code>, <code class="code">&gt;&gt;=</code>, <code class="code">&amp;=</code>, <code class="code">^=</code> and <code class="code">|=</code>.
          </p><p>
            A compound assignment operator is predefined for a given type if and only if the corresponding binary operator is predefined for the type.  It is also possible to overload the compound assignment operator for any type, and it is even possible to have different types for the left and right operands. See <a class="xref" href="#overloading-compound-ass-ops" title="Compound Assignment Overloads">the section called “Compound Assignment Overloads”</a>.
          </p></div></div><div class="section" title="Operators and Polymorphism"><div class="titlepage"><div><div><h3 class="title"><a name="ops-and-polymorphism"></a>Operators and Polymorphism</h3></div></div></div><p>
          Operator invocations are subject to the same rules as function calls with respect to polymorphism.  If an exact match for an operator with the parameter types equal to the operand types is not found, KL will find the best-match among the existing implementations of the operator.  This makes it possible, for instance, to add an integer and a string; the result is that the integer is cast to a string and then the strings are concatenated.
        </p><p>
          For more information on polymorphism and best-match rules, see <a class="xref" href="#polymorphism" title="Function Polymorphism">the section called “Function Polymorphism”</a>.
        </p></div></div><div class="section" title="Expressions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="exprs"></a>Expressions</h2></div></div></div><p>
        There are two types of expressions in KL: simple expressions and compound expressions.
      </p><div class="section" title="Simple Expressions"><div class="titlepage"><div><div><h3 class="title"><a name="simple-exprs"></a>Simple Expressions</h3></div></div></div><p>
          <em class="glossterm">Simple expressions</em> are the expressions from which more complex expressions are derived.  The simple expressions are:
          
          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Symbols that refer to variables, function arguments or global constants.  The type of the expression is the type of the entity referred to.  Examples: <code class="code">foo</code>, <code class="code">myParam</code>, <code class="code">mathPI</code>.  See <a class="xref" href="#scope" title="Scoping Rules">the section called “Scoping Rules”</a> for how symbol names are resolved.</p></li><li class="listitem"><p>Boolean, integer, floating-point and string constants.  The type of the expression is the type of the constant.  Examples: <code class="code">true</code>, <code class="code">42</code>, <code class="code">3.14159</code>.  See <a class="xref" href="#constants" title="Constants">the section called “Constants”</a>.</p></li></ul></div><p>
        </p></div><div class="section" title="Compound Expressions"><div class="titlepage"><div><div><h3 class="title"><a name="compound-exprs"></a>Compound Expressions</h3></div></div></div><p>
          <em class="glossterm">Compound expressions</em> are built from <a class="link" href="#simple-exprs" title="Simple Expressions">simple expressions</a> and/or other compound expressions using <a class="link" href="#ops" title="Operators">operators</a>.
        </p><p>
          The following table lists all the different compound expressions in KL.  Compound expressions are grouped by <em class="glossterm">type</em>; all expressions of the same type are of the same precedence and share the same associativity.  Compound expression types are listed from highest to lowest precedence.
        </p><div class="table"><a name="d5e1842"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Compound expressions</b></p><div class="table-contents"><table summary="Compound expressions" border="1"><colgroup><col align="left" class="type" width="25%"><col align="left" class="assoc" width="25%"><col align="left" class="expr" width="25%"><col align="left" class="ref" width="25%"></colgroup><thead><tr><th align="left">Type</th><th align="left">Associativity</th><th align="left">Expression(s)</th><th align="left">Reference</th></tr></thead><tbody><tr><td rowspan="6" align="left">Postfix</td><td rowspan="6" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>function</code></em>(<em class="replaceable"><code>args</code></em>)</code></td><td align="left"><a class="xref" href="#function-calls" title="Function Invocations">the section called “Function Invocations”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>[<em class="replaceable"><code>expr</code></em>]</code></td><td align="left"><a class="xref" href="#arrays" title="Arrays">the section called “Arrays”</a>; <a class="xref" href="#dicts" title="Dictionaries">the section called “Dictionaries”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>.<em class="replaceable"><code>member</code></em></code></td><td align="left"><a class="xref" href="#structs" title="Structures">the section called “Structures”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>.<em class="replaceable"><code>method</code></em>(<em class="replaceable"><code>args</code></em>)</code></td><td align="left"><a class="xref" href="#method-calls" title="Method Invocation">the section called “Method Invocation”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>++</code></td><td rowspan="2" align="left"><a class="xref" href="#inc-dec-ops" title="Increment and Decrement Operators">the section called “Increment and Decrement Operators”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>--</code></td></tr><tr><td rowspan="6" align="left">Prefix</td><td rowspan="6" align="left">right-to-left</td><td align="left"><code class="code">+<em class="replaceable"><code>expr</code></em></code></td><td rowspan="2" align="left"><a class="xref" href="#unary-plus-minus-ops" title="Unary Plus and Minus">the section called “Unary Plus and Minus”</a></td></tr><tr><td align="left"><code class="code">-<em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code">++<em class="replaceable"><code>expr</code></em></code></td><td rowspan="2" align="left"><a class="xref" href="#inc-dec-ops" title="Increment and Decrement Operators">the section called “Increment and Decrement Operators”</a></td></tr><tr><td align="left"><code class="code">--<em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code">!<em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#logical-not" title="Logical NOT">the section called “Logical NOT”</a></td></tr><tr><td align="left"><code class="code">~<em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#bitwise-not" title="Bitwise NOT">the section called “Bitwise NOT”</a></td></tr><tr><td rowspan="3" align="left">Multiplicative</td><td rowspan="3" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> * <em class="replaceable"><code>expr</code></em></code></td><td rowspan="3" align="left"><a class="xref" href="#mul-ops" title="Multiply, Divide and Remainder">the section called “Multiply, Divide and Remainder”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> / <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> % <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td rowspan="2" align="left">Additive</td><td rowspan="2" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> + <em class="replaceable"><code>expr</code></em></code></td><td rowspan="2" align="left"><a class="xref" href="#add-ops" title="Add and Subtract">the section called “Add and Subtract”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> - <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td rowspan="2" align="left">Shift</td><td rowspan="2" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &lt;&lt; <em class="replaceable"><code>expr</code></em></code></td><td rowspan="2" align="left"><a class="xref" href="#shift-ops" title="Left and Right Shift">the section called “Left and Right Shift”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &gt;&gt; <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td rowspan="4" align="left">Relational</td><td rowspan="4" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &lt; <em class="replaceable"><code>expr</code></em></code></td><td rowspan="4" align="left"><a class="xref" href="#rel-ops" title="Relational Operators">the section called “Relational Operators”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &lt;= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &gt; <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &gt;= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td rowspan="2" align="left">Equality</td><td rowspan="2" align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> == <em class="replaceable"><code>expr</code></em></code></td><td rowspan="2" align="left"><a class="xref" href="#eq-ops" title="Equality Operators">the section called “Equality Operators”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> != <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left">Bitwise AND</td><td align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &amp; <em class="replaceable"><code>expr</code></em></code></td><td rowspan="3" align="left"><a class="xref" href="#bit-bin-ops" title="Bitwise AND, OR and XOR">the section called “Bitwise AND, OR and XOR”</a></td></tr><tr><td align="left">Bitwise XOR</td><td align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> ^ <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left">Bitwise OR</td><td align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> | <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left">Logical AND</td><td align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &amp;&amp; <em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#log-and-op" title="Logical AND">the section called “Logical AND”</a></td></tr><tr><td align="left">Logical OR</td><td align="left">left-to-right</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> || <em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#log-or-op" title="Logical OR">the section called “Logical OR”</a></td></tr><tr><td align="left">Conditional</td><td align="left">right-to-left</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em>? <em class="replaceable"><code>expr</code></em>: <em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#cond-op" title="The Conditional Operator">the section called “The Conditional Operator”</a></td></tr><tr><td rowspan="11" align="left">Assignment</td><td rowspan="11" align="left">right-to-left</td><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> = <em class="replaceable"><code>expr</code></em></code></td><td align="left"><a class="xref" href="#direct-ass-op" title="Direct Assignment Operator">the section called “Direct Assignment Operator”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> += <em class="replaceable"><code>expr</code></em></code></td><td rowspan="10" align="left"><a class="xref" href="#compound-ass-ops" title="Compound Assignment Operators">the section called “Compound Assignment Operators”</a></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> -= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> *= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> /= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> %= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &lt;&lt;= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &gt;&gt;= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> &amp;= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> ^= <em class="replaceable"><code>expr</code></em></code></td></tr><tr><td align="left"><code class="code"><em class="replaceable"><code>expr</code></em> |= <em class="replaceable"><code>expr</code></em></code></td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section" title="Controlling Order of Operations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="order-of-ops"></a>Controlling Order of Operations</h2></div></div></div><p>
        The order of operations can be explicitly controlled by putting <code class="code">(</code> and <code class="code">)</code> (parentheses) around expressions.
      </p><div class="example"><a name="d5e2134"></a><p class="title"><b>Example&nbsp;5.1.&nbsp;Controlling Order of Operations</b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  report( (2 * 3) + 5 );
  report( 2 * (3 + 5) );
}
        </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
11
16
        </pre></div></div><div class="section" title="Scoping Rules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scope"></a>Scoping Rules</h2></div></div></div><p>
        The term <em class="glossterm">scope</em> in programming languages refers to the parts of a program in which variables, constants and functions are visible; the rules that govern how scopes work are referred to as <em class="glossterm">scoping rules</em>.  Scopes are also responsible for managing the <span class="quote">“<span class="quote">lifecycle</span>”</span> of variables; in the case of KL, this refers to when destructors are called for structure values.
      </p><div class="section" title="Types of Scopes"><div class="titlepage"><div><div><h3 class="title"><a name="scope.types"></a>Types of Scopes</h3></div></div></div><p>
          In KL, there are four kinds scopes: the global scope, function scopes, compound statement scopes and temporary scopes.  Scopes <em class="glossterm">nest</em> inside each other; when a KL program refers to a variable by name, the compiler determines which variable is being referred to by searching from the current innermost scope outwards through the nested scopes to the outermost scope (which is always the global scope).  Like C, KL is a statically-scoped language, meaning that the exact variable that is being referred to is resolved at compile time (and not at run time).
        </p><div class="section" title="The Global Scope"><div class="titlepage"><div><div><h4 class="title"><a name="scope.global"></a>The Global Scope</h4></div></div></div><p>
            The global scope is the top-level scope of a KL program.  The symbols that are visible in the global scope are global constants as well as functions and operators.  The global scope is always the outermost scope at any point in a KL program.
          </p></div><div class="section" title="Function Scope"><div class="titlepage"><div><div><h4 class="title"><a name="scope.function"></a>Function Scope</h4></div></div></div><p>
            Whenever a function or operator is defined, a function scope is created that is nested inside the global scope.  The arguments to the function are provided within the function scope.  Within the function scope, a function definition also creates a compound statement scope corresponding to the compound statement that constitutes the body of the function.
          </p></div><div class="section" title="Compound Statement Scope"><div class="titlepage"><div><div><h4 class="title"><a name="scope.compound-statement"></a>Compound Statement Scope</h4></div></div></div><p>
            Any time that a <code class="code">{</code> followed by zero or more statements followed by <code class="code">}</code> is used to introduce a compound statement, a new <em class="glossterm">compound statement scope</em> is introduced.  Compound statement scopes are nested inside function scopes (when they correspond to the compound statement that constitutes the body of a function) or inside other compound statement scopes.
          </p><p>
            When control reaches the end of a compound statement (by executing the last statement or via the <code class="code">return</code>, <code class="code">break</code> or <code class="code">continue</code> statements), any structure values that have corresponding destructors will have those destructors executed.
          </p><p>
            Note that declaring a loop index variable inside a loop statement is a special case of a compound statement scope.  In the case that the loop body is a compound statement, the corresponding compound statement scope is nested inside the loop's compound statement scope.
          </p></div><div class="section" title="Temporary Scope"><div class="titlepage"><div><div><h4 class="title"><a name="scope.temporary"></a>Temporary Scope</h4></div></div></div><p>
            Any time that a constructor is directly invoked to create a temporary value (see <a class="xref" href="#constructors.invocation.call">???</a>), a scope is created to contain the temporary value.  The scope encloses the surrounding expression of the temporary value; this means that when the surrounding expression is finished execution, the temporary value's destructor, if it exists, is executed.
          </p></div></div><div class="section" title="Nested Scopes Example"><div class="titlepage"><div><div><h3 class="title"><a name="scope.example"></a>Nested Scopes Example</h3></div></div></div><p>
          For a precise understanding of the nesting of KL scopes, study the following example carefully!
        </p><div class="example"><a name="scope.ex"></a><p class="title"><b>Example&nbsp;5.2.&nbsp;Nested scopes</b></p><div class="example-contents"><pre class="programlisting">
struct T {
  String s;
};

function T(String s) {
  this.s = s;
  report("created T; s = " + this.s);
}

function ~T() {
  report("destroying T; s = " + this.s);
}

function foo(T t) {
  report("start of foo; t is now " + t);
  T t("fooT");
  report("declared t in foo; t is now " + t);
  for (Index i=0; i&lt;3; ++i) {
    report("top of loop body; t is now " + t);
    T t("loopT:" + i);
    report("declared t in loop; t is now " + t);
  }
  report("after loop; t is now " + t);
}

const Float32 t = 2.75;

operator entry() {
  report("top of entry; t is now " + t);
  T t("entryT");
  report("declared t in entry; t is now " + t);
  foo(t);
  report("came back from foo; t is now " + t);
}
          </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
top of entry; t is now 2.75
created T; s = entryT
declared t in entry; t is now {s:"entryT"}
start of foo; t is now {s:"entryT"}
created T; s = fooT
declared t in foo; t is now {s:"fooT"}
top of loop body; t is now {s:"fooT"}
created T; s = loopT:0
declared t in loop; t is now {s:"loopT:0"}
destroying T; s = loopT:0
top of loop body; t is now {s:"fooT"}
created T; s = loopT:1
declared t in loop; t is now {s:"loopT:1"}
destroying T; s = loopT:1
top of loop body; t is now {s:"fooT"}
created T; s = loopT:2
declared t in loop; t is now {s:"loopT:2"}
destroying T; s = loopT:2
after loop; t is now {s:"fooT"}
destroying T; s = fooT
came back from foo; t is now {s:"entryT"}
destroying T; s = entryT
          </pre></div></div></div></div><div class="chapter" title="Chapter&nbsp;6.&nbsp;Statements"><div class="titlepage"><div><div><h2 class="title"><a name="statements"></a>Chapter&nbsp;6.&nbsp;Statements</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#simple-statements">Simple Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#expr-statements">Expression Statements</a></span></dt><dt><span class="section"><a href="#throw-statement">The <code class="code">throw</code> Statement</a></span></dt><dt><span class="section"><a href="#empty-statement">The Empty Statement</a></span></dt><dt><span class="section"><a href="#var-decl-statements">Variable Declaration Statements</a></span></dt></dl></dd><dt><span class="section"><a href="#complex-statements">Complex Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#compound-statements">Compound Statements</a></span></dt><dt><span class="section"><a href="#cond-statements">Conditional Statements</a></span></dt><dt><span class="section"><a href="#return-statement">The <code class="code">return</code> Statement</a></span></dt><dt><span class="section"><a href="#loop-statements">Loop Statements</a></span></dt></dl></dd></dl></div><p>
      The bodies of functions, operators, and so on are composed of <em class="glossterm">statements</em>.  Statements are the parts of KL programs that actually do something.  Statements cause expressions to be evaluated, can conditionally execute other statements, or can iterate over another set of statements until a condition is met.
    </p><p>
      The remainder of the chapter describes the different statements that can be used inside KL function definitions.  Statements are divided into two categories: simple statements and complex statements.
    </p><div class="section" title="Simple Statements"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="simple-statements"></a>Simple Statements</h2></div></div></div><p>
        A simple statement is a statement that does not check conditions or create a nested scope.  Simple statements always end with a <code class="code">;</code> (semicolon) character.

        </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>
          It is a common syntax error in KL and other C-like languages to forget to finish a simple statement with a semicolon.
        </p></td></tr></table></div><p>
      </p><div class="section" title="Expression Statements"><div class="titlepage"><div><div><h3 class="title"><a name="expr-statements"></a>Expression Statements</h3></div></div></div><p>
          Any expression, followed by a <code class="code">;</code> (semicolon), is a statement.  The statement operates by evaluating the expression and then discarding the resulting value (if any).  The most common form of an expression statement is one that invokes a function call (eg. <code class="code">report</code>).
        </p><div class="example"><a name="d5e2196"></a><p class="title"><b>Example&nbsp;6.1.&nbsp;Expression statements</b></p><div class="example-contents"><pre class="programlisting">
            
operator entry() {
  // A very useless expression statement:
  // evaluates 2 + 2 then discards the
  // result
  2 + 2;

  // A more useful expression statement:
  // evaluates the report function, which
  // causes text to appear
  report("Hello!"); 
}
            
          </pre></div></div><br class="example-break"></div><div class="section" title="The throw Statement"><div class="titlepage"><div><div><h3 class="title"><a name="throw-statement"></a>The <code class="code">throw</code> Statement</h3></div></div></div><p>
          The keyword <code class="code">throw</code>, followed by any argument, causes the argument to a string and then throws an exception whose value is the string.  This can be used to throw an exception, exiting out of the KL environment entirely and returning the exception to the calling environment (ie. the dynamic language using KL).
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          Currently there is no way of catching exceptions from within KL itself. This functionality will be added in a later version of Fabric Engine.
        </p></td></tr></table></div><div class="example"><a name="d5e2206"></a><p class="title"><b>Example&nbsp;6.2.&nbsp;The <code class="code">throw</code> statement</b></p><div class="example-contents"><pre class="programlisting">
            
operator entry() {
  report("before throw");
  throw "Test Exception";
  report("after throw");
}
            
          </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
            
before throw
Caught exception: Test Exception
          
          </pre></div></div><div class="section" title="The Empty Statement"><div class="titlepage"><div><div><h3 class="title"><a name="empty-statement"></a>The Empty Statement</h3></div></div></div><p>
          A <code class="code">;</code> (semicolon) alone is a statement that does nothing.  This can be used in cases where a statement is required but there is nothing to do.
        </p><div class="example"><a name="d5e2217"></a><p class="title"><b>Example&nbsp;6.3.&nbsp;The empty statement</b></p><div class="example-contents"><pre class="programlisting">
            
function foo(io MyType myType) {
  for (; returnsFalseWhenDone(myType); )
    ; // Do nothing
}
            
          </pre></div></div><br class="example-break"></div><div class="section" title="Variable Declaration Statements"><div class="titlepage"><div><div><h3 class="title"><a name="var-decl-statements"></a>Variable Declaration Statements</h3></div></div></div><p>
          A <em class="glossterm">variable declaration statement</em> introduces one or more new variables into the innermost scope.  These variables remain visible for the rest of the scope and are destroyed, executing destructors when appropriate, when execution exists this scope.
        </p><p>
          Variable declarations require a type.  Multiple variables can be declared in the same statement by separating them with commas.
        </p><p>
          The variable names can be followed by array and dictionary specifications.  See <a class="xref" href="#arrays" title="Arrays">the section called “Arrays”</a> and <a class="xref" href="#dicts" title="Dictionaries">the section called “Dictionaries”</a> for more information on array and dictionary specifications.
        </p><p>
          Variables can be constructed or assigned to when declared to set their initial values; see <a class="xref" href="#constructors" title="Constructors">the section called “Constructors”</a>.
        </p><div class="example"><a name="d5e2230"></a><p class="title"><b>Example&nbsp;6.4.&nbsp;Variable declaration statements</b></p><div class="example-contents"><pre class="programlisting">
          
operator entry() {
  Scalar a;
  report(a);
  Integer b[], c[2][2], d;
  report(b);
  report(c);
  report(d);
}
            
          </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
            
0
[]
[[0,0],[0,0]]
0
          
          </pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          As of this writing, it is not yet possible to initialize arrays in KL in the statement where the variable is declared.
        </p></td></tr></table></div></div></div><div class="section" title="Complex Statements"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="complex-statements"></a>Complex Statements</h2></div></div></div><p>
        A <em class="glossterm">complex statement</em> is a statement that groups together and/or conditionally executes other statements.  Complex statements are built from simple statements, other complex statements, and expressions.
      </p><div class="section" title="Compound Statements"><div class="titlepage"><div><div><h3 class="title"><a name="compound-statements"></a>Compound Statements</h3></div></div></div><p>
          At any point when a single statement can be inserted in KL source code, it is possible to insert multiple statements surrounded by <code class="code">{</code> (left brace) and <code class="code">}</code> (right brace).  This has the following effects:

          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              The statements are executed, in order, as if they were together a single statement; and
            </p></li><li class="listitem"><p>
              A new, nested scope is introduced; see <a class="xref" href="#scope" title="Scoping Rules">the section called “Scoping Rules”</a>.
            </p></li></ul></div><p>
        </p></div><div class="section" title="Conditional Statements"><div class="titlepage"><div><div><h3 class="title"><a name="cond-statements"></a>Conditional Statements</h3></div></div></div><div class="section" title="The if Statement"><div class="titlepage"><div><div><h4 class="title"><a name="if-statement"></a>The <code class="code">if</code> Statement</h4></div></div></div><p>
            The <code class="code">if</code> keyword begins a conditional statement, which can optionally include an <code class="code">else</code> clause.  As in JavaScript and C, <code class="code">if</code> and <code class="code">else</code> statements can chain.
          </p><div class="example"><a name="d5e2263"></a><p class="title"><b>Example&nbsp;6.5.&nbsp;The <code class="code">if</code> statement</b></p><div class="example-contents"><pre class="programlisting">
              
function String desc(Integer n) {
  if (n == 0)
    return "zero";
  else if (n == 1)
    return "one";
  else
    return "lots";
}
              
            </pre></div></div><br class="example-break"></div><div class="section" title="The switch Statement"><div class="titlepage"><div><div><h4 class="title"><a name="switch-statement"></a>The <code class="code">switch</code> Statement</h4></div></div></div><p>
            The <code class="code">switch</code>...<code class="code">case</code> construct is a more compact form for a sequence of <code class="code">if</code>...<code class="code">else</code> statements, just as in JavaScript and C.
          </p><div class="example"><a name="d5e2275"></a><p class="title"><b>Example&nbsp;6.6.&nbsp;The <code class="code">switch</code> statement</b></p><div class="example-contents"><pre class="programlisting">
              
function String descNumber(Integer i) {
  switch (i) {
    case 0:
      return "zero";
    case 1:
      return "one";
    case 2:
    case 3;
    case 4:
      return "a few";
    default:
      return "many";
  }
}
              
            </pre></div></div><br class="example-break"></div></div><div class="section" title="The return Statement"><div class="titlepage"><div><div><h3 class="title"><a name="return-statement"></a>The <code class="code">return</code> Statement</h3></div></div></div><p>
          The <code class="code">return</code> statement takes two forms:

          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              For a function which returns a value, the <code class="code">return</code> statement immediately returns the given value to the calling function.  There is an implicit cast to the type of the return value as specified in the function definition.
            </p></li><li class="listitem"><p>
              For a function which does not return a value, the <code class="code">return</code> statement does not take a value and simply returns immediately to the calling function.
            </p></li></ul></div><p>
        </p><div class="example"><a name="d5e2291"></a><p class="title"><b>Example&nbsp;6.7.&nbsp;The <code class="code">return</code> statement</b></p><div class="example-contents"><pre class="programlisting">
            
// Function that returns a value
function String markupName(String name) {
  return "My name is '" + name + "'";
}

// Function that does not return a value
function suffixIndexDesc(io String strings[], Size index) {
  if (index &gt;= strings.size)
    return;
  strings[index] += " (was at index " + index + ")";
}
            
          </pre></div></div><br class="example-break"></div><div class="section" title="Loop Statements"><div class="titlepage"><div><div><h3 class="title"><a name="loop-statements"></a>Loop Statements</h3></div></div></div><div class="section" title="“C-Style” Loops"><div class="titlepage"><div><div><h4 class="title"><a name="c-style-loop"></a><span class="quote">“<span class="quote">C-Style</span>”</span> Loops</h4></div></div></div><p>
            A <em class="glossterm">C-style loop</em> takes the form <code class="code">for (<em class="replaceable"><code>start</code></em>; <em class="replaceable"><code>check</code></em>; <em class="replaceable"><code>next</code></em>) <em class="replaceable"><code>body</code></em></code>, where <code class="code"><em class="replaceable"><code>start</code></em></code> is a statement (possibly empty), <code class="code"><em class="replaceable"><code>check</code></em></code> and <code class="code"><em class="replaceable"><code>next</code></em></code> are optional expressions, and <code class="code"><em class="replaceable"><code>body</code></em></code> is a statement.  The loop operates as follows:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                A new, nested scope is created.  This scope is destroyed when the loop finishes.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>start</code></em></code> statement is executed.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>check</code></em></code> expression, if present, is evaluated, and the resulting value is converted to a <code class="code">Boolean</code>.  If the result is false, the loop finishes.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>body</code></em></code> statement is executed.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>next</code></em></code> expression, if present, is evaluated, and the resulting value is discarded.  Execution is transferred back to the step that evaluates the <code class="code"><em class="replaceable"><code>check</code></em></code> expression.
              </p></li></ul></div><p>

            Note that since <code class="code"><em class="replaceable"><code>start</code></em></code> is a statement, it is possible to declare a new variable there.  This variable will go out-of-scope when the loop finishes.  It is common practice to declare loop-bound index variables in the <code class="code"><em class="replaceable"><code>start</code></em></code> statement.
          </p><div class="example"><a name="d5e2341"></a><p class="title"><b>Example&nbsp;6.8.&nbsp;<span class="quote">“<span class="quote">C-Style</span>”</span> loop</b></p><div class="example-contents"><pre class="programlisting">
              
operator entry() {
  for (Index i=0; i&lt;10; ++i)
    report("i is now " + i);
}
              
            </pre></div></div><br class="example-break"></div><div class="section" title="while Loops"><div class="titlepage"><div><div><h4 class="title"><a name="while-loops"></a><code class="code">while</code> Loops</h4></div></div></div><p>
            A <em class="glossterm">while loop</em> takes the form <code class="code">while (<em class="replaceable"><code>check</code></em>) <em class="replaceable"><code>body</code></em></code>, where <code class="code"><em class="replaceable"><code>check</code></em></code> is a expression and <code class="code"><em class="replaceable"><code>body</code></em></code> is a statement.  The loop operates as follows:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>check</code></em></code> expression is evaluated, and the resulting value is converted to a <code class="code">Boolean</code>.  If the result is false, the loop finishes.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>body</code></em></code> statement is executed.
              </p></li><li class="listitem"><p>
                Execution is transferred back to the step that evaluates the <code class="code"><em class="replaceable"><code>check</code></em></code> expression.
              </p></li></ul></div><p>
          </p><div class="example"><a name="d5e2371"></a><p class="title"><b>Example&nbsp;6.9.&nbsp;<code class="code">while</code> loop</b></p><div class="example-contents"><pre class="programlisting">
              
operator entry() {
  Integer i = 0;
  while (i &lt; 10) {
    report("i is now " + i);
    ++i;
  }
}
              
            </pre></div></div><br class="example-break"></div><div class="section" title="do...while Loops"><div class="titlepage"><div><div><h4 class="title"><a name="do-while-loops"></a><code class="code">do</code>...<code class="code">while</code> Loops</h4></div></div></div><p>
            A <em class="glossterm">do-while loop</em> takes the form <code class="code">do <em class="replaceable"><code>body</code></em> while (<em class="replaceable"><code>check</code></em>);</code>, where <code class="code"><em class="replaceable"><code>check</code></em></code> is a expression and <code class="code"><em class="replaceable"><code>body</code></em></code> is a statement.  The loop operates as follows:

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>body</code></em></code> statement is executed.
              </p></li><li class="listitem"><p>
                The <code class="code"><em class="replaceable"><code>check</code></em></code> expression is evaluated, and the resulting value is converted to a <code class="code">Boolean</code>.  If the result is false, the loop finishes.
              </p></li><li class="listitem"><p>
                Execution is transferred back to the step that executes the <code class="code"><em class="replaceable"><code>body</code></em></code> statement.
              </p></li></ul></div><p>
          </p><div class="example"><a name="d5e2402"></a><p class="title"><b>Example&nbsp;6.10.&nbsp;<code class="code">do</code>...<code class="code">while</code> loop</b></p><div class="example-contents"><pre class="programlisting">
              
operator entry() {
  Integer i=0;
  do {
    report("i is now " + i);
    ++i;
  } while (i&lt;10);
}
              
            </pre></div></div><br class="example-break"></div><div class="section" title="Dictionary Loops"><div class="titlepage"><div><div><h4 class="title"><a name="dict-loops"></a>Dictionary Loops</h4></div></div></div><p>
            A dictionary loop iterates over all the keys and values, or just the values, in a dictionary.  For more information on dictionary loops, see <a class="xref" href="#dicts" title="Dictionaries">the section called “Dictionaries”</a>.
          </p></div><div class="section" title="Loop Control Statements"><div class="titlepage"><div><div><h4 class="title"><a name="loop-control-statements"></a>Loop Control Statements</h4></div></div></div><p>
            Within the body of a loop, the <code class="code">break</code> and <code class="code">continue</code> statements can be used to prematurely end the current iteration of the loop as described below.
          </p><div class="section" title="The break Statement"><div class="titlepage"><div><div><h5 class="title"><a name="break-statement"></a>The <code class="code">break</code> Statement</h5></div></div></div><p>
              The <code class="code">break;</code> statement immediately exits the innermost loop.  It is an error to use the <code class="code">break</code> statement outside of a loop.
            </p><div class="example"><a name="d5e2422"></a><p class="title"><b>Example&nbsp;6.11.&nbsp;The <code class="code">break</code> statement</b></p><div class="example-contents"><pre class="programlisting">
                
operator entry() {
  // Only loops 5 times
  for (Integer i=0; ; ++i) {
    if (i == 5)
      break;
  }
}
                
              </pre></div></div><br class="example-break"></div><div class="section" title="The continue Statement"><div class="titlepage"><div><div><h5 class="title"><a name="continue-statement"></a>The <code class="code">continue</code> Statement</h5></div></div></div><p>
              The <code class="code">continue;</code> statement immediately jumps to the next iteration of the innermost loop.  It is an error to use the <code class="code">continue</code> statement outside of a loop.
            </p><div class="example"><a name="d5e2432"></a><p class="title"><b>Example&nbsp;6.12.&nbsp;The <code class="code">continue</code> statement</b></p><div class="example-contents"><pre class="programlisting">
                
operator entry() {
  // Only prints 7
  for (Integer i=0; i&lt;10; ++i) {
    if (i != 7)
      continue;
    report(i);
  }
}
                
              </pre></div></div><br class="example-break"></div></div></div></div></div><div class="chapter" title="Chapter&nbsp;7.&nbsp;Map-Reduce"><div class="titlepage"><div><div><h2 class="title"><a name="map-reduce"></a>Chapter&nbsp;7.&nbsp;Map-Reduce</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#mr-types">Map-Reduce Types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-producer">The <code class="code">ValueProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</a></span></dt><dt><span class="section"><a href="#array-producer">The <code class="code">ArrayProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</a></span></dt></dl></dd><dt><span class="section"><a href="#mr-functions">Map-Reduce Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e2534">Value Producer Creation Functions</a></span></dt><dt><span class="section"><a href="#d5e2677">Array Producer Creation Functions</a></span></dt><dt><span class="section"><a href="#d5e2841">Reduce Creation Functions</a></span></dt></dl></dd></dl></div><p>
      Fabric Engine provides a generic map-reduce framework that can be used to create recursively-parallel operations on large data sets.
    </p><p>
      This chapter does not attempt to explain the concepts behind and usage of the Fabric Engine map-reduce framework; it serves purely to enumerate the types and functions that are provided in KL to support the framework.  For more information on concepts and usage of the map-reduce framework, refer to the 
      <a class="link" href="http://documentation.fabric-engine.com/latest/FabricEngine-MapReduceProgrammingGuide.html" target="_top">
        <span class="quote">“<span class="quote">Map-Reduce Programming Guide</span>”</span>
      </a>
      
      .
    </p><div class="section" title="Map-Reduce Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mr-types"></a>Map-Reduce Types</h2></div></div></div><p>
        In order to support map-reduce, KL introduces two new derived types: <code class="code">ValueProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> and <code class="code">ArrayProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code>.
      </p><div class="section" title="The ValueProducer<...&gt; Type"><div class="titlepage"><div><div><h3 class="title"><a name="value-producer"></a>The <code class="code">ValueProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</h3></div></div></div><p>
          Given an existing type <code class="code"><em class="replaceable"><code>ValueType</code></em></code>, the type <code class="code">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;</code> is a map-reduce value producer that produces values of type <code class="code"><em class="replaceable"><code>ValueType</code></em></code>.  Values of type <code class="code">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;</code> have the following properties:

          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              They can be assigned to variables of the same type; however, there must be an exact match for <code class="code"><em class="replaceable"><code>ValueType</code></em></code>.  In other words, <code class="code">ValueProducer&lt;<em class="replaceable"><code>ValueType1</code></em>&gt;</code> and <code class="code">ValueProducer&lt;<em class="replaceable"><code>ValueType2</code></em>&gt;</code> are the same type if and only if <code class="code"><em class="replaceable"><code>ValueType1</code></em></code> and <code class="code"><em class="replaceable"><code>ValueType2</code></em></code> are the same type.
            </p></li><li class="listitem"><p>
              They support a method </p><pre class="programlisting">function <em class="replaceable"><code>ValueType</code></em> ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;.produce();</pre><p> that produces the value producer's value.
            </p></li><li class="listitem"><p>
              They support a method </p><pre class="programlisting">function ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;.flush();</pre><p> that recursively flushes any caches connected to the value producer.
            </p></li></ul></div><p>
        </p></div><div class="section" title="The ArrayProducer<...&gt; Type"><div class="titlepage"><div><div><h3 class="title"><a name="array-producer"></a>The <code class="code">ArrayProducer&lt;<em class="replaceable"><code>...</code></em>&gt;</code> Type</h3></div></div></div><p>
          Given an existing type <code class="code"><em class="replaceable"><code>ElementType</code></em></code>, the type <code class="code">ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;</code> is a map-reduce array producer that produces values of type <code class="code"><em class="replaceable"><code>ElementType</code></em></code>.  Values of type <code class="code">ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;</code> have the following properties:

          </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              They can be assigned to variables of the same type; however, there must be an exact match for <code class="code"><em class="replaceable"><code>ElementType</code></em></code>.  In other words, <code class="code">ArrayProducer&lt;<em class="replaceable"><code>ElementType1</code></em>&gt;</code> and <code class="code">ArrayProducer&lt;<em class="replaceable"><code>ElementType2</code></em>&gt;</code> are the same type if and only if <code class="code"><em class="replaceable"><code>ElementType1</code></em></code> and <code class="code"><em class="replaceable"><code>ElementType2</code></em></code> are the same type.
            </p></li><li class="listitem"><p>
              They support a method </p><pre class="programlisting">function Size ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;.getCount();</pre><p> that returns the number of elements in the array producer.  Calling <code class="code">produce(<em class="replaceable"><code>i</code></em>)</code> (below) with <code class="code"><em class="replaceable"><code>i</code></em></code> not less than the result of <code class="code">getCount()</code> will cause an exception to be thrown.
            </p></li><li class="listitem"><p>
              They support a method </p><pre class="programlisting">function <em class="replaceable"><code>ElementType</code></em> ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;.produce(Index <em class="replaceable"><code>i</code></em>);</pre><p> that produces the array producer's element at index <code class="code"><em class="replaceable"><code>i</code></em></code>.
            </p></li><li class="listitem"><p>
              They support a method </p><pre class="programlisting">function ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;.flush();</pre><p> that recursively flushes any caches connected to the array producer.
            </p></li></ul></div><p>
        </p></div></div><div class="section" title="Map-Reduce Functions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mr-functions"></a>Map-Reduce Functions</h2></div></div></div><p>
        KL supports several functions to support the creation of new value and array producers from existing producers as well as KL functions and values.
      </p><div class="section" title="Value Producer Creation Functions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2534"></a>Value Producer Creation Functions</h3></div></div></div><div class="section" title="createConstValue"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2536"></a><code class="code">createConstValue</code></h4></div></div></div><pre class="programlisting">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt; createConstValue(<em class="replaceable"><code>expr</code></em>)</pre><p>
            Creates a value producer with value type <em class="replaceable"><code>ValueType</code></em> that returns a constant value.  <em class="replaceable"><code>expr</code></em> must be an expression that evaluates to a value.
          </p><div class="example"><a name="d5e2545"></a><p class="title"><b>Example&nbsp;7.1.&nbsp;<code class="code">createConstValue</code></b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  ValueProducer&lt;Integer&gt; vp = createConstValue( 42 );
  report(vp);
  report(vp.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">]
ValueProducer&lt;Integer&gt;
42
            </pre></div></div><div class="section" title="createValueGenerator"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2552"></a><code class="code">createValueGenerator</code></h4></div></div></div><pre class="programlisting">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt; createValueGenerator(<em class="replaceable"><code>operatorName</code></em>[, ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;])</pre><p>
            Creates a value producer with value type <em class="replaceable"><code>ValueType</code></em> that calls the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to generate the value.

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                  If <code class="code">ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operator operatorName(io <em class="replaceable"><code>ValueType</code></em> value, <em class="replaceable"><code>SharedValueType</code></em> sharedValue);</pre><p>
                </p></li><li class="listitem"><p>
                  Otherwise, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operator operatorName(io <em class="replaceable"><code>ValueType</code></em> value);</pre><p>
                </p></li></ul></div><p>
          </p><div class="example"><a name="d5e2579"></a><p class="title"><b>Example&nbsp;7.2.&nbsp;<code class="code">createValueGenerator</code></b></p><div class="example-contents"><pre class="programlisting">
operator gen1(io String output) {
  output = "Hello!";
}

operator gen2(io String output, String shared) {
  output = "Hello, " + shared;
}

operator entry() {
  ValueProducer&lt;String&gt; vp1 = createValueGenerator(gen1);
  report("vp1 = " + vp1);
  report("vp1.produce() = " + vp1.produce());

  ValueProducer&lt;String&gt; vp2 = createValueGenerator(gen2, vp1);
  report("vp2 = " + vp2);
  report("vp2.produce() = " + vp2.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">]
vp1 = ValueProducer&lt;String&gt;
vp1.produce() = Hello!
vp2 = ValueProducer&lt;String&gt;
vp2.produce() = Hello, Hello!
            </pre></div></div><div class="section" title="createValueTransform"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2586"></a><code class="code">createValueTransform</code></h4></div></div></div><pre class="programlisting">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt; createValueTransform(ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;, <em class="replaceable"><code>operatorName</code></em>[, ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;])</pre><p>
            Creates a value producer with value type <em class="replaceable"><code>ValueType</code></em> that calls the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to transform the result of another value producer of the same type.

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                  If <code class="code">ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operator operatorName(io <em class="replaceable"><code>ValueType</code></em> value, <em class="replaceable"><code>SharedValueType</code></em> sharedValue);</pre><p>
                </p></li><li class="listitem"><p>
                  Otherwise, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operator operatorName(io <em class="replaceable"><code>ValueType</code></em> value);</pre><p>
                </p></li></ul></div><p>
          </p><div class="example"><a name="d5e2614"></a><p class="title"><b>Example&nbsp;7.3.&nbsp;<code class="code">createValueTransform</code></b></p><div class="example-contents"><pre class="programlisting">
operator multByTwo(
  io Integer value
  )
{
  value *= 2;
}

operator multByShared(
  io Integer value,
  Integer shared
  )
{
  value *= shared;
}

operator entry() {
  ValueProducer&lt;Integer&gt; vp;
  
  vp = createValueTransform(
    createConstValue( 42 ),
    multByTwo
    );
  report(vp);
  report(vp.produce());

  vp = createValueTransform(
    createConstValue( 2 ),
    multByShared,
    createConstValue( 3 )
    );
  report(vp);
  report(vp.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">]
ValueProducer&lt;Integer&gt;
84
ValueProducer&lt;Integer&gt;
6
            </pre></div></div><div class="section" title="createValueMap"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2621"></a><code class="code">createValueMap</code></h4></div></div></div><pre class="programlisting">ValueProducer&lt;<em class="replaceable"><code>OutputValueType</code></em>&gt; createValueMap(ValueProducer&lt;<em class="replaceable"><code>InputValueType</code></em>&gt;, <em class="replaceable"><code>operatorName</code></em>[, ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;])</pre><p>
            Creates a value producer with value type <em class="replaceable"><code>OutputValueType</code></em> that calls the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to map the result of another value producer of type <code class="code">ValueProducer&lt;<em class="replaceable"><code>InputValueType</code></em>&gt;</code>.

            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                  If <code class="code">ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt;</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operator operatorName(<em class="replaceable"><code>InputValueType</code></em> inputValue, io <em class="replaceable"><code>OutputValueType</code></em> outputValue, <em class="replaceable"><code>SharedValueType</code></em> sharedValue);</pre><p>
                </p></li><li class="listitem"><p>
                  Otherwise, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype </p><pre class="programlisting">operatorName(<em class="replaceable"><code>InputValueType</code></em> inputValue, io <em class="replaceable"><code>OutputValueType</code></em> outputValue);</pre><p>
                </p></li></ul></div><p>
          </p><div class="example"><a name="d5e2653"></a><p class="title"><b>Example&nbsp;7.4.&nbsp;<code class="code">createValueMap</code></b></p><div class="example-contents"><pre class="programlisting">
operator multByPi(
  Integer input,
  io Scalar output
  )
{
  output = 3.14 * input;
}

operator multByShared(
  Integer input,
  io Scalar output,
  Scalar shared
  )
{
  output = input * shared;
}

operator entry() {
  ValueProducer&lt;Scalar&gt; vp;
  
  vp = createValueMap(
    createConstValue( 42 ),
    multByPi
    );
  report(vp);
  report(vp.produce());

  vp = createValueMap(
    createConstValue( 2 ),
    multByShared,
    createConstValue( Scalar(2.71) )
    );
  report(vp);
  report(vp.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">]
ValueProducer&lt;Scalar&gt;
131.88
ValueProducer&lt;Scalar&gt;
5.42
            </pre></div></div><div class="section" title="createValueCache"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2660"></a><code class="code">createValueCache</code></h4></div></div></div><pre class="programlisting">ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt; createValueCache(ValueProducer&lt;<em class="replaceable"><code>ValueType</code></em>&gt;)</pre><p>
            Creates a value producer with value type <em class="replaceable"><code>ValueType</code></em> that caches the result of another value producer of the same type.  For more information on producer caches, see refer to the
            <a class="link" href="http://documentation.fabric-engine.com/latest/FabricEngine-MapReduceProgrammingGuide.html" target="_top">
              <span class="quote">“<span class="quote">Map-Reduce Programming Guide</span>”</span>
            </a>
            
            .
          </p><div class="example"><a name="d5e2670"></a><p class="title"><b>Example&nbsp;7.5.&nbsp;<code class="code">createValueCache</code></b></p><div class="example-contents"><pre class="programlisting">
operator valueGen(
  io Scalar output
  )
{
  output = 2.71;
  report("Generating output = " + output);
}

operator entry() {
  ValueProducer&lt;Scalar&gt; vp = createValueCache(createValueGenerator(valueGen));
  report("vp.produce() = " + vp.produce());
  report("vp.produce() = " + vp.produce());
  report("calling vp.flush()");
  vp.flush();
  report("vp.produce() = " + vp.produce());
  report("vp.produce() = " + vp.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">]
Generating output = 2.71
vp.produce() = 2.71
vp.produce() = 2.71
calling vp.flush()
Generating output = 2.71
vp.produce() = 2.71
vp.produce() = 2.71
            </pre></div></div></div><div class="section" title="Array Producer Creation Functions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2677"></a>Array Producer Creation Functions</h3></div></div></div><div class="section" title="createConstArray"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2679"></a><code class="code">createConstArray</code></h4></div></div></div><pre class="programlisting">ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createConstArray(<em class="replaceable"><code>arrayExpr</code></em>)</pre><p>
            Creates a constant array producer.  <em class="replaceable"><code>arrayExpr</code></em> must be an expression that evaluates to an array (variable-size, fixed-size or sliced) whose element type is <em class="replaceable"><code>ElementType</code></em>.  The array is <span class="quote">“<span class="quote">frozen</span>”</span> in the resulting array producer; that is, if the array used in the call to <code class="code">createConstArray</code> is later changed, the result of  <code class="code">createConstArray</code> will not change.
          </p><div class="example"><a name="d5e2691"></a><p class="title"><b>Example&nbsp;7.6.&nbsp;<code class="code">createConstArray</code></b></p><div class="example-contents"><pre class="programlisting">
operator entry() {
  Integer a[]; a.push(42); a.push(17); a.push(52); a.push(871);
  ArrayProducer&lt;Integer&gt; ap = createConstArray(a);
  report(ap);
  report(ap.getCount());
  report(ap.produce(2));
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
ArrayProducer&lt;Integer&gt;
4
52
            </pre></div></div><div class="section" title="createArrayGenerator"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2698"></a><code class="code">createArrayGenerator</code></h4></div></div></div><p>
            <code class="code">createArrayGenerator</code> has one of the following <span class="quote">“<span class="quote">prototypes</span>”</span>:

            </p><pre class="programlisting">
function ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createArrayGenerator(
  ValueProducer&lt;Size&gt; countProducer,
  <em class="replaceable"><code>operatorName</code></em>
  )

function ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createArrayGenerator(
  ValueProducer&lt;Size&gt; countProducer,
  <em class="replaceable"><code>operatorName</code></em>,
  ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt; sharedValueProducer
  )
            </pre><p>
          </p><p>
            <code class="code">createArrayGenerator</code> creates an array producer with element type <em class="replaceable"><code>ElementType</code></em> that calls the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to generate the elements of the array.
          </p><p>
            If <code class="code">sharedValueProducer</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index,
  Size count,
  <em class="replaceable"><code>SharedValueType</code></em> sharedValue
  );
            </pre><p>

            Otherwise, it must name an operator with any of the following prototypes:

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index,
  Size count
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue
  );
            </pre><p>
          </p><div class="example"><a name="d5e2730"></a><p class="title"><b>Example&nbsp;7.7.&nbsp;<code class="code">createArrayGenerator</code></b></p><div class="example-contents"><pre class="programlisting">
operator generator(
  io Float32 value,
  Size index,
  Size count,
  Float32 shared
  )
{
  report("generator: value=" + value + " index=" + index + " count=" + count + " shared=" + shared);
  value = shared*index;
}

operator entry() {
  ValueProducer&lt;Size&gt; cvg = createConstValue(Size(10));
  ArrayProducer&lt;Float32&gt; ag4 = createArrayGenerator(cvg, generator, createConstValue(Float32(3.141)));
  report(ag4);
  report(ag4.getCount());
  for (Size i=0; i&lt;10; ++i)
    report(ag4.produce(i));
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
ArrayProducer&lt;Float32&gt;
10
generator: value=0 index=0 count=10 shared=3.141
0
generator: value=0 index=1 count=10 shared=3.141
3.141
generator: value=0 index=2 count=10 shared=3.141
6.282
generator: value=0 index=3 count=10 shared=3.141
9.423
generator: value=0 index=4 count=10 shared=3.141
12.564
generator: value=0 index=5 count=10 shared=3.141
15.705
generator: value=0 index=6 count=10 shared=3.141
18.846
generator: value=0 index=7 count=10 shared=3.141
21.987
generator: value=0 index=8 count=10 shared=3.141
25.128
generator: value=0 index=9 count=10 shared=3.141
28.269
            </pre></div></div><div class="section" title="createArrayTransform"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2737"></a><code class="code">createArrayTransform</code></h4></div></div></div><p>
            <code class="code">createArrayTransform</code> has one of the following <span class="quote">“<span class="quote">prototypes</span>”</span>:

            </p><pre class="programlisting">
function ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createArrayTransform(
  ArrayProducer&lt;ElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>
  )

function ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createArrayTransform(
  ArrayProducer&lt;ElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>,
  ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt; sharedValueProducer
  )
            </pre><p>
          </p><p>
            <code class="code">createArrayTransform</code> creates an array producer with element type <em class="replaceable"><code>ElementType</code></em> that transforms <code class="code">inputArrayProducer</code> by calling the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to transform the individual elements.
          </p><p>
            If <code class="code">sharedValueProducer</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index,
  Size count,
  <em class="replaceable"><code>SharedValueType</code></em> sharedValue
  );
            </pre><p>

            Otherwise, it must name an operator with any of the following prototypes:

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index,
  Size count
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue,
  Size index
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  io <em class="replaceable"><code>ElementType</code></em> elementValue
  );
            </pre><p>
          </p><div class="example"><a name="d5e2770"></a><p class="title"><b>Example&nbsp;7.8.&nbsp;<code class="code">createArrayTransform</code></b></p><div class="example-contents"><pre class="programlisting">
operator transform(
  io Float32 value,
  Size index,
  Size count,
  Float32 shared
  )
{
  report("transform: value=" + value + " index=" + index + " count=" + count + " shared=" + shared);
  value *= shared * (index + 1);
}

operator entry() {
  Float32 inputArray[]; inputArray.push(5.6); inputArray.push(-3.4); inputArray.push(1.4142);
  ArrayProducer&lt;Float32&gt; inputArrayProducer = createConstArray(inputArray);
  ArrayProducer&lt;Float32&gt; transformedArrayProducer = createArrayTransform(inputArrayProducer, transform, createConstValue(Float32(2.56)));
  report(transformedArrayProducer);
  report(transformedArrayProducer.getCount());
  Size transformedArrayProducerCount = transformedArrayProducer.getCount();
  for (Index i=0; i&lt;transformedArrayProducerCount; ++i)
    report(transformedArrayProducer.produce(i));
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
ArrayProducer&lt;Float32&gt;
3
transform: value=5.6 index=0 count=3 shared=2.56
14.336
transform: value=-3.4 index=1 count=3 shared=2.56
-17.408
transform: value=1.4142 index=2 count=3 shared=2.56
10.86106
            </pre></div></div><div class="section" title="createArrayMap"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2777"></a><code class="code">createArrayMap</code></h4></div></div></div><p>
            <code class="code">createArrayMap</code> has one of the following <span class="quote">“<span class="quote">prototypes</span>”</span>:

            </p><pre class="programlisting">
function ArrayProducer&lt;<em class="replaceable"><code>OutputElementType</code></em>&gt; createArrayMap(
  ArrayProducer&lt;InputElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>
  )

function ArrayProducer&lt;<em class="replaceable"><code>OutputElementType</code></em>&gt; createArrayMap(
  ArrayProducer&lt;InputElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>,
  ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt; sharedValueProducer
  )
            </pre><p>
          </p><p>
            <code class="code">createArrayMap</code> creates an array producer with element type <code class="code"><em class="replaceable"><code>OutputElementType</code></em></code> that maps <code class="code">inputArrayProducer</code> of a potentially different element type <code class="code"><em class="replaceable"><code>InputElementType</code></em></code> by calling the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to map the individual elements.
          </p><p>
            If <code class="code">sharedValueProducer</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputElementType</code></em> outputElementValue,
  Size index,
  Size count,
  <em class="replaceable"><code>SharedValueType</code></em> sharedValue
  );
            </pre><p>

            Otherwise, it must name an operator with any of the following prototypes:

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputElementType</code></em> outputElementValue,
  Size index,
  Size count
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputElementType</code></em> outputElementValue,
  Size index
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputElementType</code></em> outputElementValue
  );
            </pre><p>
          </p><div class="example"><a name="d5e2817"></a><p class="title"><b>Example&nbsp;7.9.&nbsp;<code class="code">createArrayMap</code></b></p><div class="example-contents"><pre class="programlisting">
operator map(
  Float32 inputValue,
  io String outputValue,
  Size index,
  Size count,
  Float32 shared
  )
{
  report("map: inputValue=" + inputValue + " index=" + index + " count=" + count + " shared=" + shared);
  Float32 float32Value = inputValue * shared * (index + 1);
  if (abs(float32Value) &lt; 1.0)
    outputValue = "small";
  else if (abs(float32Value) &lt; 10.0)
    outputValue = "medium";
  else if (abs(float32Value) &lt; 100.0)
    outputValue = "large";
  else
    outputValue = "x-large";
}

operator entry() {
  Float32 inputArray[]; inputArray.push(5.6); inputArray.push(-0.034); inputArray.push(1.4142);
  ArrayProducer&lt;Float32&gt; inputArrayProducer = createConstArray(inputArray);
  ArrayProducer&lt;String&gt; mappedArrayProducer = createArrayMap(inputArrayProducer, map, createConstValue(Float32(2.56)));
  report(mappedArrayProducer);
  report(mappedArrayProducer.getCount());
  Size mappedArrayProducerCount = mappedArrayProducer.getCount();
  for (Index i=0; i&lt;mappedArrayProducerCount; ++i)
    report(mappedArrayProducer.produce(i));
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
ArrayProducer&lt;String&gt;
3
map: inputValue=5.6 index=0 count=3 shared=2.56
large
map: inputValue=-0.034 index=1 count=3 shared=2.56
small
map: inputValue=1.4142 index=2 count=3 shared=2.56
large
            </pre></div></div><div class="section" title="createArrayCache"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2824"></a><code class="code">createArrayCache</code></h4></div></div></div><pre class="programlisting">ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt; createArrayCache(ArrayProducer&lt;<em class="replaceable"><code>ElementType</code></em>&gt;)</pre><p>
            Creates an array producer with array type <em class="replaceable"><code>ElementType</code></em> that caches the result of another array producer of the same type.  For more information on producer caches, refer to the
            <a class="link" href="http://documentation.fabric-engine.com/latest/FabricEngine-MapReduceProgrammingGuide.html" target="_top">
              <span class="quote">“<span class="quote">Map-Reduce Programming Guide</span>”</span>
            </a>
            
            .
          </p><div class="example"><a name="d5e2834"></a><p class="title"><b>Example&nbsp;7.10.&nbsp;<code class="code">createArrayCache</code></b></p><div class="example-contents"><pre class="programlisting">
operator elementGen(
  io Scalar output,
  Size index
  )
{
  output = 2.71 * index;
  report("Generating output = " + output);
}

operator entry() {
  ArrayProducer&lt;Scalar&gt; ap = createArrayCache(
    createArrayGenerator(
      createConstValue(Size(4)),
      elementGen
      )
    );
  report("ap.produce(2) = " + ap.produce(2));
  report("ap.produce(2) = " + ap.produce(2));
  report("calling ap.flush()");
  ap.flush();
  report("ap.produce(2) = " + ap.produce(2));
  report("ap.produce(2) = " + ap.produce(2));
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
Generating output = 5.42
ap.produce(2) = 5.42
ap.produce(2) = 5.42
calling ap.flush()
Generating output = 5.42
ap.produce(2) = 5.42
ap.produce(2) = 5.42
            </pre></div></div></div><div class="section" title="Reduce Creation Functions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2841"></a>Reduce Creation Functions</h3></div></div></div><div class="section" title="createReduce"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2843"></a><code class="code">createReduce</code></h4></div></div></div><p>
            <code class="code">createReduce</code> has one of the following <span class="quote">“<span class="quote">prototypes</span>”</span>:

            </p><pre class="programlisting">
function ValueProducer&lt;<em class="replaceable"><code>OutputValueType</code></em>&gt; createReduce(
  ArrayProducer&lt;InputElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>
  )

function ValueProducer&lt;<em class="replaceable"><code>OutputValueType</code></em>&gt; createReduce(
  ArrayProducer&lt;InputElementType&gt; inputArrayProducer,
  <em class="replaceable"><code>operatorName</code></em>,
  ValueProducer&lt;<em class="replaceable"><code>SharedValueType</code></em>&gt; sharedValueProducer
  )
            </pre><p>
          </p><p>
            <code class="code">createReduce</code> creates a value producer with value type <code class="code"><em class="replaceable"><code>OutputValueType</code></em></code> that reduces <code class="code">inputArrayProducer</code> by calling the operator named <code class="code"><em class="replaceable"><code>operatorName</code></em></code> to contribute the individual elements to the reduction.
          </p><p>
            If <code class="code">sharedValueProducer</code> is provided, <code class="code"><em class="replaceable"><code>operatorName</code></em></code> must name an operator with prototype

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputValueType</code></em> outputValue,
  Size index,
  Size count,
  <em class="replaceable"><code>SharedValueType</code></em> sharedValue
  );
            </pre><p>

            Otherwise, it must name an operator with any of the following prototypes:

            </p><pre class="programlisting">
operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputValueType</code></em> outputValue,
  Size index,
  Size count
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputValueType</code></em> outputValue,
  Size index
  );

operator <em class="replaceable"><code>operatorName</code></em>(
  <em class="replaceable"><code>InputElementType</code></em> inputElementValue,
  io <em class="replaceable"><code>OutputValueType</code></em> outputValue
  );
            </pre><p>
          </p><div class="example"><a name="d5e2881"></a><p class="title"><b>Example&nbsp;7.11.&nbsp;<code class="code">createReduce</code></b></p><div class="example-contents"><pre class="programlisting">
operator generator(
  io Integer outputValue,
  Size index
  )
{
  outputValue = index + 1;
}

operator reduce(
  Integer inputValue,
  io Integer outputValue
  )
{
  report("reduce: inputValue=" + inputValue);
  outputValue += inputValue;
}

operator entry() {
  ValueProducer&lt;Integer&gt; sum = createReduce(
    createArrayGenerator(
      createConstValue(Size(10)),
      generator
      ),
    reduce
    );
  report("sum.produce() = " + sum.produce());
}
            </pre></div></div><br class="example-break"><div class="informalfigure"><p>Output:</p><pre class="screen">
reduce: inputValue=1
reduce: inputValue=2
reduce: inputValue=3
reduce: inputValue=4
reduce: inputValue=5
reduce: inputValue=6
reduce: inputValue=7
reduce: inputValue=8
reduce: inputValue=9
reduce: inputValue=10
sum.produce() = 55
            </pre></div></div></div></div></div></div></body></html>